{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/lib/utils.ts"],"sourcesContent":["// src/lib/utils.ts\nimport { type ClassValue, clsx } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n"],"names":[],"mappings":";;;;AAAA,mBAAmB;AACnB;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,uOAAO,EAAC,IAAA,iMAAI,EAAC;AACtB"}},
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/lib/scoring.ts"],"sourcesContent":["import { NDKEvent } from \"@nostr-dev-kit/ndk\";\n\nexport interface ScoreResult {\n  totalScore: number;\n  uniqueUsers: number;\n  lightningSuccessCount: number;\n  lightningRatio: number;\n}\n\n// ‚úÖ CONFIGURATION (LOCKED)\nconst WEIGHT_STATUS = { success: 1.0, failed: 0.25, did_not_try: 0.1 };\nconst WEIGHT_METHOD = { lightning: 1.0, onchain: 0.8, none: 0.5 };\nconst USER_WEEKLY_CAP = 10;\n\n/**\n * v1 User Weight Stub\n * Currently locked to 1.0.\n * In v2, this will check account age, WoT, and Zap history.\n */\nfunction getUserWeight(pubkey: string, _events: NDKEvent[]): number {\n  return 1.0;\n}\n\n/**\n * Calculates the City Pulse Score based on a set of check-in events.\n * Deterministic & Client-Side Verifiable.\n */\nexport function calculateCityPulse(events: NDKEvent[]): ScoreResult {\n  const userScores: Record<string, number> = {};\n  const seenPlacesByUser: Record<string, Set<string>> = {}; // Anti-Farming\n\n  let totalScore = 0;\n  let lightningSuccessCount = 0;\n  let lightningTotalCount = 0;\n\n  for (const event of events) {\n    const pubkey = event.pubkey;\n\n    // 1. Extract Tags\n    const statusTag =\n      (event.tags.find(\n        (t) => t[0] === \"status\"\n      )?.[1] as keyof typeof WEIGHT_STATUS) || \"did_not_try\";\n    const methodTag =\n      (event.tags.find(\n        (t) => t[0] === \"method\"\n      )?.[1] as keyof typeof WEIGHT_METHOD) || \"none\";\n    const placeId = event.tags.find((t) => t[0] === \"place\")?.[1] || \"unknown\";\n\n    // 2. Base Score Calculation\n    let score =\n      (WEIGHT_STATUS[statusTag] || 0.1) * (WEIGHT_METHOD[methodTag] || 0.5);\n\n    // 3. Merchant Uniqueness (Batch-Local Anti-Farming)\n    if (!seenPlacesByUser[pubkey]) seenPlacesByUser[pubkey] = new Set();\n    const isFirstVisit = !seenPlacesByUser[pubkey].has(placeId);\n    const merchantMultiplier = isFirstVisit ? 1.0 : 0.3; // Penalty for repeats\n\n    seenPlacesByUser[pubkey].add(placeId);\n    score *= merchantMultiplier;\n\n    // 4. User Weighting (Sybil Resistance)\n    const userWeight = getUserWeight(pubkey, events);\n    score *= userWeight;\n\n    // 5. Weekly Cap Enforcement\n    const currentUserScore = userScores[pubkey] || 0;\n    if (currentUserScore >= USER_WEEKLY_CAP) continue; // Hard Cap\n\n    const effectiveScore = Math.min(score, USER_WEEKLY_CAP - currentUserScore);\n    userScores[pubkey] = currentUserScore + effectiveScore;\n\n    // Add to Aggregate\n    totalScore += effectiveScore;\n\n    // Stats\n    if (methodTag === \"lightning\") {\n      lightningTotalCount++;\n      if (statusTag === \"success\") lightningSuccessCount++;\n    }\n  }\n\n  const uniqueUsers = Object.keys(userScores).length;\n  const lightningRatio =\n    lightningTotalCount > 0 ? lightningSuccessCount / lightningTotalCount : 0;\n\n  return {\n    totalScore: parseFloat(totalScore.toFixed(1)),\n    uniqueUsers,\n    lightningSuccessCount,\n    lightningRatio,\n  };\n}\n\n/**\n * Calculates Signal Strength (0-1) for a single merchant based on history.\n * Prioritizes Lightning Success.\n */\nexport function calculateMerchantIntensity(events: NDKEvent[]): number {\n  if (events.length === 0) return 0;\n\n  const lightningSuccesses = events.filter(\n    (e) =>\n      e.tags.some((t) => t[0] === \"status\" && t[1] === \"success\") &&\n      e.tags.some((t) => t[0] === \"method\" && t[1] === \"lightning\")\n  ).length;\n\n  const anySuccess = events.filter((e) =>\n    e.tags.some((t) => t[0] === \"status\" && t[1] === \"success\")\n  ).length;\n\n  // Tiered Intensity\n  if (lightningSuccesses >= 3) return 1.0; // High Certainty\n  if (lightningSuccesses >= 1) return 0.7; // Validated\n  if (anySuccess >= 1) return 0.4; // Non-LN Success\n  return 0.2; // Unverified Activity\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/components/map/MerchantDrawer.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { Merchant } from \"@/lib/types\";\nimport {\n  X,\n  MapPin,\n  Zap,\n  Bitcoin,\n  Navigation,\n  User,\n  KeyRound,\n  Eye,\n  EyeOff,\n  ThumbsUp,\n  ThumbsDown,\n  Meh,\n  Activity,\n  Signal,\n  Loader2,\n  AlertCircle,\n  CheckCircle2,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useSession } from \"@/contexts/NostrSessionContext\";\nimport { NDKEvent, NDKUserProfile } from \"@nostr-dev-kit/ndk\";\nimport { calculateMerchantIntensity } from \"@/lib/scoring\";\n\ninterface MerchantDrawerProps {\n  merchant: Merchant | null;\n  onClose: () => void;\n}\n\ntype ProfileMap = Record<string, NDKUserProfile>;\n\nexport default function MerchantDrawer({\n  merchant,\n  onClose,\n}: MerchantDrawerProps) {\n  const { session, loginWithExtension, loginWithNsec, publishSignal, ndk } =\n    useSession();\n\n  // Data State\n  const [reviews, setReviews] = useState<NDKEvent[]>([]);\n  const [profiles, setProfiles] = useState<ProfileMap>({});\n  const [loadingReviews, setLoadingReviews] = useState(false);\n\n  // Login UI State\n  const [showNsecInput, setShowNsecInput] = useState(false);\n  const [nsec, setNsec] = useState(\"\");\n  const [showSecret, setShowSecret] = useState(false);\n\n  // Reporting State\n  const [isReporting, setIsReporting] = useState(false);\n  const [paymentStatus, setPaymentStatus] = useState<\n    \"success\" | \"failed\" | \"did_not_try\"\n  >(\"success\");\n  const [comment, setComment] = useState(\"\");\n\n  // UX State\n  const [isPublishing, setIsPublishing] = useState(false);\n  const [publishError, setPublishError] = useState<string | null>(null);\n\n  // Reliability Score\n  const [reliability, setReliability] = useState(0);\n\n  // Scroll Ref\n  const feedTopRef = useRef<HTMLDivElement>(null);\n\n  // 1. Fetch Logic\n  useEffect(() => {\n    if (merchant && ndk) {\n      setLoadingReviews(true);\n      setIsReporting(false);\n      setPaymentStatus(\"success\");\n      setComment(\"\");\n      setPublishError(null);\n\n      // Fetch by place ID\n      const filter = {\n        kinds: [1],\n        \"#place\": [merchant.id],\n        \"#t\": [\"satsrover\"],\n        limit: 50,\n      };\n\n      ndk.fetchEvents(filter).then(async (events) => {\n        const notes = Array.from(events).sort(\n          (a, b) => b.created_at! - a.created_at!\n        );\n        setReviews(notes);\n\n        const score = calculateMerchantIntensity(notes);\n        setReliability(score);\n\n        if (notes.length > 0) {\n          const uniquePubkeys = Array.from(new Set(notes.map((n) => n.pubkey)));\n          const newProfiles: ProfileMap = {};\n          await Promise.all(\n            uniquePubkeys.map(async (pk) => {\n              const user = ndk.getUser({ pubkey: pk });\n              const profile = await user.fetchProfile();\n              if (profile) newProfiles[pk] = profile;\n            })\n          );\n          setProfiles((prev) => ({ ...prev, ...newProfiles }));\n        }\n        setLoadingReviews(false);\n      });\n    } else {\n      setReviews([]);\n      setReliability(0);\n    }\n  }, [merchant, ndk]);\n\n  // Handlers\n  const handleLoginStart = async () => {\n    if (window.nostr) {\n      try {\n        await loginWithExtension();\n      } catch (e) {\n        setShowNsecInput(true);\n      }\n    } else {\n      setShowNsecInput(true);\n    }\n  };\n\n  const handleNsecSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!nsec.startsWith(\"nsec1\")) {\n      alert(\"Invalid format\");\n      return;\n    }\n    await loginWithNsec(nsec);\n    setShowNsecInput(false);\n  };\n\n  const handleSubmitReport = async () => {\n    if (!merchant) return;\n\n    setIsPublishing(true);\n    setPublishError(null);\n\n    // 1. Publish to Network\n    const success = await publishSignal(\n      merchant.name,\n      merchant.id,\n      merchant.lat,\n      merchant.lon,\n      paymentStatus,\n      \"lightning\",\n      comment\n    );\n\n    setIsPublishing(false);\n\n    if (success) {\n      // 2. Optimistic UI Update (Show immediately without refetch)\n      const statusEmoji =\n        paymentStatus === \"success\"\n          ? \"‚úÖ\"\n          : paymentStatus === \"failed\"\n            ? \"‚ùå\"\n            : \"üëÄ\";\n      const optimisticNote = {\n        id: `opt-${Date.now()}`,\n        pubkey: session.pubkey || \"unknown\",\n        created_at: Math.floor(Date.now() / 1000),\n        content: `${statusEmoji} ${comment}`,\n        tags: [[\"status\", paymentStatus]],\n      } as NDKEvent;\n\n      setReviews((prev) => [optimisticNote, ...prev]);\n\n      // Add current user profile to map if missing\n      if (session.user?.profile && session.pubkey) {\n        setProfiles((prev) => ({\n          ...prev,\n          [session.pubkey!]: session.user!.profile!,\n        }));\n      }\n\n      setIsReporting(false);\n\n      // Scroll to top\n      setTimeout(() => {\n        feedTopRef.current?.scrollIntoView({\n          behavior: \"smooth\",\n          block: \"center\",\n        });\n      }, 100);\n    } else {\n      setPublishError(\"Signal failed to reach relays. Please retry.\");\n    }\n  };\n\n  const successCount = reviews.filter((r) =>\n    r.tags.some((t) => t[0] === \"status\" && t[1] === \"success\")\n  ).length;\n\n  return (\n    <div\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-40 transform transition-transform duration-300 ease-out\",\n        merchant ? \"translate-y-0\" : \"translate-y-full\"\n      )}\n    >\n      {/* Neon Top Border */}\n      <div className=\"h-px w-full bg-linear-to-r from-transparent via-[#F7931A] to-transparent shadow-[0_0_10px_#F7931A]\" />\n\n      <div className=\"bg-[#050505] border-t border-white/10 pb-10 pt-4 px-6 shadow-2xl min-h-[50vh] max-h-[85vh] overflow-y-auto font-mono text-gray-200\">\n        {/* Drag Handle */}\n        <div className=\"w-12 h-1 bg-white/20 rounded-full mx-auto mb-6\" />\n\n        {merchant && (\n          <>\n            {/* Header Section */}\n            <div className=\"flex justify-between items-start mb-2\">\n              <div>\n                <h2 className=\"text-2xl font-bold text-white tracking-tight uppercase\">\n                  {merchant.name}\n                </h2>\n                <div className=\"flex items-center text-[#F7931A] text-xs mt-1 uppercase tracking-widest font-bold\">\n                  <MapPin className=\"w-3 h-3 mr-1\" />\n                  <span>{merchant.category.replace(\"_\", \" \")}</span>\n                </div>\n              </div>\n              <button\n                onClick={onClose}\n                className=\"p-2 hover:bg-white/10 rounded-full transition-colors text-gray-500 hover:text-white\"\n              >\n                <X className=\"w-6 h-6\" />\n              </button>\n            </div>\n\n            {/* Signal Strength Indicator */}\n            <div className=\"mb-6 flex items-center\">\n              {reliability >= 0.7 ? (\n                <div className=\"inline-flex items-center gap-2 text-[#00FF41] text-[10px] border border-[#00FF41]/30 bg-[#00FF41]/5 px-3 py-1.5 rounded uppercase tracking-widest shadow-[0_0_8px_rgba(0,255,65,0.1)]\">\n                  <Activity className=\"w-3 h-3\" />\n                  <span className=\"font-bold\">VERIFIED: HIGH CONFIDENCE</span>\n                </div>\n              ) : reliability >= 0.4 ? (\n                <div className=\"inline-flex items-center gap-2 text-[#F7931A] text-[10px] border border-[#F7931A]/30 bg-[#F7931A]/5 px-3 py-1.5 rounded uppercase tracking-widest\">\n                  <Signal className=\"w-3 h-3\" />\n                  <span className=\"font-bold\">\n                    PARTIALLY VERIFIED ({successCount})\n                  </span>\n                </div>\n              ) : (\n                <div className=\"inline-flex items-center gap-2 text-gray-500 text-[10px] border border-white/10 bg-white/5 px-3 py-1.5 rounded uppercase tracking-widest\">\n                  <Signal className=\"w-3 h-3\" />\n                  <span className=\"font-bold\">UNVERIFIED SIGNAL</span>\n                </div>\n              )}\n            </div>\n\n            {/* Badges */}\n            <div className=\"flex flex-wrap gap-2 mb-8\">\n              {merchant.tags[\"payment:lightning\"] === \"yes\" && (\n                <span className=\"inline-flex items-center px-2 py-1 rounded border border-[#F7931A]/40 text-[#F7931A] text-[9px] font-bold uppercase tracking-wider bg-[#F7931A]/5\">\n                  <Zap className=\"w-3 h-3 mr-1 fill-[#F7931A]\" /> Lightning\n                </span>\n              )}\n              {merchant.tags[\"currency:XBT\"] === \"yes\" && (\n                <span className=\"inline-flex items-center px-2 py-1 rounded border border-white/20 text-gray-400 text-[9px] font-bold uppercase tracking-wider bg-white/5\">\n                  <Bitcoin className=\"w-3 h-3 mr-1\" /> On-Chain\n                </span>\n              )}\n            </div>\n\n            {/* ACTION AREA */}\n            <div className=\"mb-8 p-1 bg-white/5 rounded-xl border border-white/5\">\n              {session.type === \"anon\" ? (\n                // 1. LOGIN REQUIRED\n                showNsecInput ? (\n                  <form\n                    onSubmit={handleNsecSubmit}\n                    className=\"p-4 animate-in fade-in\"\n                  >\n                    <div className=\"flex justify-between items-center mb-4\">\n                      <label className=\"text-[10px] font-bold text-[#F7931A] uppercase tracking-widest\">\n                        Manual Uplink\n                      </label>\n                      <button\n                        type=\"button\"\n                        onClick={() => setShowNsecInput(false)}\n                      >\n                        <X className=\"w-4 h-4 text-gray-500 hover:text-white\" />\n                      </button>\n                    </div>\n                    <div className=\"relative mb-3\">\n                      <input\n                        type={showSecret ? \"text\" : \"password\"}\n                        placeholder=\"nsec1...\"\n                        className=\"w-full bg-black text-sm text-white p-3 pr-10 border border-white/20 rounded focus:border-[#F7931A] focus:outline-none transition-colors font-mono\"\n                        value={nsec}\n                        onChange={(e) => setNsec(e.target.value)}\n                      />\n                      <button\n                        type=\"button\"\n                        onClick={() => setShowSecret(!showSecret)}\n                        className=\"absolute right-3 top-3.5 text-gray-500 hover:text-white\"\n                      >\n                        {showSecret ? (\n                          <EyeOff className=\"w-4 h-4\" />\n                        ) : (\n                          <Eye className=\"w-4 h-4\" />\n                        )}\n                      </button>\n                    </div>\n                    <button\n                      type=\"submit\"\n                      className=\"w-full bg-[#F7931A] text-black text-xs font-bold py-3 rounded uppercase tracking-widest hover:brightness-110\"\n                    >\n                      Authenticate\n                    </button>\n                  </form>\n                ) : (\n                  <button\n                    onClick={handleLoginStart}\n                    className=\"w-full py-6 flex flex-col items-center justify-center gap-2 group\"\n                  >\n                    <KeyRound className=\"w-6 h-6 text-gray-500 group-hover:text-[#F7931A] transition-colors\" />\n                    <span className=\"text-xs uppercase tracking-widest font-bold text-gray-400 group-hover:text-white\">\n                      Login to Broadcast\n                    </span>\n                  </button>\n                )\n              ) : !isReporting ? (\n                // 2. ACTIONS (LOGGED IN)\n                <div className=\"grid grid-cols-2 gap-1\">\n                  <button\n                    onClick={() => setIsReporting(true)}\n                    className=\"bg-[#F7931A] text-black font-bold py-4 rounded-lg flex items-center justify-center gap-2 hover:brightness-110 transition-all uppercase tracking-wide text-xs\"\n                  >\n                    <Zap className=\"w-4 h-4 fill-black\" /> Report Status\n                  </button>\n                  <a\n                    href={`https://www.google.com/maps/dir/?api=1&destination=${merchant.lat},${merchant.lon}`}\n                    target=\"_blank\"\n                    rel=\"noreferrer\"\n                    className=\"bg-black/40 text-gray-300 font-bold py-4 rounded-lg flex items-center justify-center gap-2 hover:bg-white/10 transition-all uppercase tracking-wide text-xs\"\n                  >\n                    <Navigation className=\"w-4 h-4\" /> Navigate\n                  </a>\n                </div>\n              ) : (\n                // 3. REPORTING FORM\n                <div className=\"p-4 animate-in zoom-in-95\">\n                  <h4 className=\"text-xs font-bold text-gray-400 mb-4 uppercase tracking-widest text-center\">\n                    Confirm Payment Status\n                  </h4>\n\n                  {publishError && (\n                    <div className=\"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded text-red-400 text-xs flex items-center gap-2\">\n                      <AlertCircle className=\"w-4 h-4 shrink-0\" />\n                      {publishError}\n                    </div>\n                  )}\n\n                  <div className=\"flex gap-2 mb-4\">\n                    <button\n                      onClick={() => setPaymentStatus(\"success\")}\n                      className={cn(\n                        \"flex-1 py-3 rounded border flex flex-col items-center gap-1 transition-all\",\n                        paymentStatus === \"success\"\n                          ? \"bg-[#00FF41]/10 border-[#00FF41] text-[#00FF41]\"\n                          : \"bg-black border-white/10 text-gray-500 hover:border-white/30\"\n                      )}\n                    >\n                      <ThumbsUp className=\"w-4 h-4\" />{\" \"}\n                      <span className=\"text-[9px] font-bold uppercase\">\n                        Worked\n                      </span>\n                    </button>\n                    <button\n                      onClick={() => setPaymentStatus(\"failed\")}\n                      className={cn(\n                        \"flex-1 py-3 rounded border flex flex-col items-center gap-1 transition-all\",\n                        paymentStatus === \"failed\"\n                          ? \"bg-[#FF3B30]/10 border-[#FF3B30] text-[#FF3B30]\"\n                          : \"bg-black border-white/10 text-gray-500 hover:border-white/30\"\n                      )}\n                    >\n                      <ThumbsDown className=\"w-4 h-4\" />{\" \"}\n                      <span className=\"text-[9px] font-bold uppercase\">\n                        Failed\n                      </span>\n                    </button>\n                    <button\n                      onClick={() => setPaymentStatus(\"did_not_try\")}\n                      className={cn(\n                        \"flex-1 py-3 rounded border flex flex-col items-center gap-1 transition-all\",\n                        paymentStatus === \"did_not_try\"\n                          ? \"bg-white/10 border-white text-white\"\n                          : \"bg-black border-white/10 text-gray-500 hover:border-white/30\"\n                      )}\n                    >\n                      <Meh className=\"w-4 h-4\" />{\" \"}\n                      <span className=\"text-[9px] font-bold uppercase\">\n                        No Try\n                      </span>\n                    </button>\n                  </div>\n\n                  <textarea\n                    className=\"w-full p-3 bg-[#050505] text-sm text-gray-300 border border-white/20 rounded mb-4 h-24 resize-none focus:outline-none focus:border-[#F7931A] font-mono placeholder:text-gray-700\"\n                    placeholder=\"Add intel (e.g. 'Terminal behind counter')...\"\n                    value={comment}\n                    onChange={(e) => setComment(e.target.value)}\n                  />\n\n                  <div className=\"flex gap-2\">\n                    <button\n                      onClick={handleSubmitReport}\n                      disabled={isPublishing}\n                      className=\"flex-1 bg-[#F7931A] text-black font-bold py-3 rounded text-xs uppercase tracking-widest hover:brightness-110 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\n                    >\n                      {isPublishing ? (\n                        <Loader2 className=\"w-4 h-4 animate-spin\" />\n                      ) : (\n                        <Zap className=\"w-4 h-4 fill-black\" />\n                      )}\n                      {isPublishing ? \"Broadcasting...\" : \"Transmit Signal\"}\n                    </button>\n                    <button\n                      onClick={() => setIsReporting(false)}\n                      disabled={isPublishing}\n                      className=\"px-4 border border-white/20 text-gray-400 font-bold py-3 rounded text-xs uppercase tracking-widest hover:bg-white/5 disabled:opacity-50\"\n                    >\n                      Cancel\n                    </button>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* FEED SECTION */}\n            <div className=\"border-t border-white/10 pt-6\">\n              <div ref={feedTopRef} /> {/* Scroll anchor */}\n              <h3 className=\"text-[10px] font-bold text-gray-500 uppercase tracking-[0.2em] mb-4\">\n                Signal Feed\n              </h3>\n              {loadingReviews ? (\n                <div className=\"text-xs text-[#F7931A] animate-pulse font-mono\">\n                  Scanning relays for telemetry...\n                </div>\n              ) : reviews.length === 0 ? (\n                <div className=\"text-xs text-gray-600 font-mono\">\n                  No signals detected in this sector.\n                </div>\n              ) : (\n                <div className=\"space-y-3\">\n                  {reviews.map((note) => {\n                    const profile = profiles[note.pubkey];\n                    const name =\n                      profile?.name ||\n                      profile?.displayName ||\n                      note.pubkey.slice(0, 8);\n                    const image = profile?.image;\n\n                    const statusTag = note.tags.find(\n                      (t) => t[0] === \"status\"\n                    )?.[1];\n                    const isSuccess = statusTag === \"success\";\n                    const isFail = statusTag === \"failed\";\n\n                    return (\n                      <div\n                        key={note.id}\n                        className=\"bg-white/5 border border-white/5 p-3 rounded hover:border-white/10 transition-colors animate-in fade-in slide-in-from-top-2\"\n                      >\n                        <div className=\"flex items-center gap-3 mb-2\">\n                          {image ? (\n                            // eslint-disable-next-line @next/next/no-img-element\n                            <img\n                              src={image}\n                              alt={name}\n                              className=\"w-6 h-6 rounded-full object-cover grayscale opacity-80\"\n                            />\n                          ) : (\n                            <div className=\"w-6 h-6 bg-white/10 rounded-full flex items-center justify-center text-[8px] text-gray-400 font-bold\">\n                              {name.slice(0, 2).toUpperCase()}\n                            </div>\n                          )}\n                          <span className=\"font-bold text-gray-300 text-xs truncate max-w-37.5\">\n                            {name}\n                          </span>\n                          <span className=\"text-[9px] text-gray-600 ml-auto font-mono\">\n                            {new Date(\n                              note.created_at! * 1000\n                            ).toLocaleDateString()}\n                          </span>\n                        </div>\n                        <div className=\"flex gap-2 items-start\">\n                          {isSuccess && (\n                            <CheckCircle2 className=\"w-3 h-3 text-[#00FF41] mt-0.5 shrink-0\" />\n                          )}\n                          {isFail && (\n                            <AlertCircle className=\"w-3 h-3 text-[#FF3B30] mt-0.5 shrink-0\" />\n                          )}\n                          <p className=\"text-gray-400 text-xs leading-relaxed wrap-break-word w-full\">\n                            {note.content\n                              .replace(/Checking in at .* ‚ö° #SatsRover/, \"\")\n                              .replace(/‚úÖ|‚ùå|üëÄ/, \"\")\n                              .trim()}\n                          </p>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              )}\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1016, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/components/map/MapView.tsx"],"sourcesContent":["\"use client\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport maplibregl from \"maplibre-gl\";\nimport { Merchant } from \"@/lib/types\";\nimport MerchantDrawer from \"./MerchantDrawer\";\n\nconst MAP_STYLE_DARK =\n  \"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json\";\n\ninterface MapViewProps {\n  flyToCoords: { lat: number; lon: number } | null;\n  onInteract: () => void;\n}\n\n// ‚úÖ Visual Signal State Definition\ninterface VisualSignalState {\n  intensity: number; // 0.0 to 1.0\n  glow: boolean;\n  opacity: number;\n}\n\nexport default function MapView({ flyToCoords, onInteract }: MapViewProps) {\n  const mapContainer = useRef<HTMLDivElement>(null);\n  const map = useRef<maplibregl.Map | null>(null);\n  const markers = useRef<maplibregl.Marker[]>([]);\n  const [merchants, setMerchants] = useState<Merchant[]>([]);\n  const [selectedMerchant, setSelectedMerchant] = useState<Merchant | null>(\n    null\n  );\n\n  // FlyTo Logic\n  useEffect(() => {\n    if (map.current && flyToCoords) {\n      map.current.flyTo({\n        center: [flyToCoords.lon, flyToCoords.lat],\n        zoom: 14,\n        speed: 1.5,\n      });\n    }\n  }, [flyToCoords]);\n\n  // Init Map\n  useEffect(() => {\n    if (map.current || !mapContainer.current) return;\n    const container = mapContainer.current;\n    container.style.width = \"100%\";\n    container.style.height = \"100%\";\n\n    map.current = new maplibregl.Map({\n      container,\n      style: MAP_STYLE_DARK,\n      center: [-89.42, 13.49], // El Zonte\n      zoom: 15,\n      attributionControl: false,\n    });\n\n    map.current.on(\"load\", () => {\n      setTimeout(() => map.current?.resize(), 0);\n      fetchMerchants();\n    });\n    map.current.on(\"moveend\", () => fetchMerchants());\n    map.current.on(\"click\", () => {\n      setSelectedMerchant(null);\n      onInteract();\n    });\n\n    return () => {\n      map.current?.remove();\n      map.current = null;\n    };\n  }, []);\n\n  const fetchMerchants = async () => {\n    if (!map.current || map.current.getZoom() < 12) {\n      setMerchants([]);\n      return;\n    }\n    const bounds = map.current.getBounds();\n    const bbox = [\n      bounds.getSouth(),\n      bounds.getWest(),\n      bounds.getNorth(),\n      bounds.getEast(),\n    ]\n      .map((c) => c.toFixed(4))\n      .join(\",\");\n\n    try {\n      const res = await fetch(`/api/merchants?bbox=${bbox}`);\n      const json = await res.json();\n      if (json.data) setMerchants(json.data);\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  // ‚úÖ DERIVE VISUAL STATE (The \"Signal\" Logic)\n  const deriveVisualState = (merchant: Merchant): VisualSignalState => {\n    // 1. Bootstrap (Source)\n    const isVerified = merchant.source === \"btcmap\";\n\n    // 2. Visual Logic\n    // Verified = 100% Opacity, Strong Glow\n    // Unverified = 40% Opacity, No Glow\n    return {\n      intensity: isVerified ? 1.0 : 0.2,\n      glow: isVerified,\n      opacity: isVerified ? 1.0 : 0.4,\n    };\n  };\n\n  // ‚úÖ RENDER MARKERS (All Orange)\n  useEffect(() => {\n    if (!map.current) return;\n    markers.current.forEach((m) => m.remove());\n    markers.current = [];\n\n    merchants.forEach((merchant) => {\n      const container = document.createElement(\"div\");\n      container.className = \"cursor-pointer p-3\";\n\n      const dot = document.createElement(\"div\");\n      const state = deriveVisualState(merchant);\n\n      // ‚úÖ UNIFIED ORANGE LOGIC\n      const baseStyle =\n        \"rounded-full bg-[#F7931A] transition-all duration-300 hover:scale-150 hover:opacity-100 hover:shadow-[0_0_10px_#F7931A]\";\n      const glowStyle = state.glow\n        ? \"shadow-[0_0_15px_#F7931A] border-2 border-white z-30\"\n        : \"border border-white/10 z-10\";\n      const sizeStyle = state.glow ? \"w-4 h-4\" : \"w-2 h-2\";\n\n      dot.className = `${baseStyle} ${glowStyle} ${sizeStyle}`;\n      dot.style.opacity = state.opacity.toString();\n\n      container.appendChild(dot);\n\n      container.addEventListener(\"click\", (e) => {\n        e.stopPropagation();\n        setSelectedMerchant(merchant);\n        onInteract();\n        map.current?.flyTo({ center: [merchant.lon, merchant.lat], zoom: 16 });\n      });\n\n      markers.current.push(\n        new maplibregl.Marker({ element: container })\n          .setLngLat([merchant.lon, merchant.lat])\n          .addTo(map.current!)\n      );\n    });\n  }, [merchants]);\n\n  return (\n    <div className=\"relative w-full h-full bg-[#050505]\">\n      <div ref={mapContainer} className=\"absolute inset-0\" />\n      <MerchantDrawer\n        merchant={selectedMerchant}\n        onClose={() => setSelectedMerchant(null)}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1214, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/components/wallet/WalletDrawer.tsx"],"sourcesContent":["// src/components/wallet/WalletDrawer.tsx\nimport React, { useState } from \"react\";\nimport {\n  X,\n  Zap,\n  LogOut,\n  Send,\n  Loader2,\n  Terminal,\n  ShieldCheck,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface WalletDrawerProps {\n  isOpen: boolean;\n  onClose: () => void;\n  status: \"idle\" | \"connecting\" | \"connected\" | \"error\";\n  balance: number | null;\n  onConnect: (str: string) => void;\n  onDisconnect: () => void;\n  onPay: (invoice: string) => Promise<any>;\n}\n\nexport default function WalletDrawer({\n  isOpen,\n  onClose,\n  status,\n  balance,\n  onConnect,\n  onDisconnect,\n  onPay,\n}: WalletDrawerProps) {\n  const [nwcString, setNwcString] = useState(\"\");\n  const [invoice, setInvoice] = useState(\"\");\n  const [paying, setPaying] = useState(false);\n  const [paymentResult, setPaymentResult] = useState<\n    \"success\" | \"error\" | null\n  >(null);\n\n  if (!isOpen) return null;\n\n  const handlePay = async () => {\n    if (!invoice) return;\n    setPaying(true);\n    setPaymentResult(null);\n    try {\n      await onPay(invoice);\n      setPaymentResult(\"success\");\n      setInvoice(\"\");\n      setTimeout(() => setPaymentResult(null), 3000);\n    } catch (e) {\n      setPaymentResult(\"error\");\n    } finally {\n      setPaying(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none\">\n      <div\n        className=\"absolute inset-0 bg-black/60 backdrop-blur-sm pointer-events-auto\"\n        onClick={onClose}\n      />\n\n      <div className=\"relative w-full max-w-md bg-charcoal border-t sm:border border-charcoal-light rounded-t-2xl sm:rounded-2xl p-6 pointer-events-auto shadow-2xl animate-in slide-in-from-bottom text-gray-200 font-mono\">\n        {/* Header */}\n        <div className=\"flex justify-between items-center mb-6 border-b border-charcoal-light pb-4\">\n          <h2 className=\"text-lg font-bold flex items-center gap-2 text-bitcoin\">\n            <Terminal className=\"w-5 h-5\" />\n            NWC_TERMINAL\n          </h2>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-charcoal-light rounded-full text-gray-400\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        {status === \"connected\" ? (\n          <div className=\"space-y-6\">\n            {/* Balance Card */}\n            <div className=\"text-center py-6 bg-charcoal-light/50 rounded-xl border border-charcoal-light\">\n              <p className=\"text-gray-500 text-[10px] uppercase tracking-[0.2em] mb-2\">\n                AVAILABLE LIQUIDITY\n              </p>\n              <h3 className=\"text-4xl font-bold text-white tracking-tight\">\n                {balance?.toLocaleString()}{\" \"}\n                <span className=\"text-lg text-bitcoin\">sats</span>\n              </h3>\n            </div>\n\n            {/* Permissions Badge */}\n            <div className=\"flex items-center gap-2 text-[10px] text-matrix bg-matrix/10 p-2 rounded border border-matrix/20\">\n              <ShieldCheck className=\"w-3 h-3\" />\n              SESSION SECURE. PERMISSIONS: PAY_INVOICE\n            </div>\n\n            {/* Pay Form */}\n            <div>\n              <label className=\"text-xs font-bold text-gray-400 uppercase mb-2 block\">\n                Execute Payment\n              </label>\n              <div className=\"flex gap-2\">\n                <input\n                  className=\"flex-1 p-3 bg-black border border-charcoal-light rounded-lg text-xs font-mono text-white focus:ring-1 focus:ring-bitcoin outline-none\"\n                  placeholder=\"lnbc...\"\n                  value={invoice}\n                  onChange={(e) => setInvoice(e.target.value)}\n                />\n                <button\n                  onClick={handlePay}\n                  disabled={paying || !invoice}\n                  className={cn(\n                    \"px-4 rounded-lg font-bold text-black flex items-center justify-center transition-all\",\n                    paymentResult === \"success\"\n                      ? \"bg-matrix\"\n                      : paymentResult === \"error\"\n                        ? \"bg-red-500\"\n                        : \"bg-bitcoin hover:brightness-110\"\n                  )}\n                >\n                  {paying ? (\n                    <Loader2 className=\"w-5 h-5 animate-spin\" />\n                  ) : (\n                    <Send className=\"w-5 h-5\" />\n                  )}\n                </button>\n              </div>\n              {/* ‚úÖ FIXED: Escaped the '>>' characters */}\n              {paymentResult === \"success\" && (\n                <p className=\"text-xs text-matrix mt-2\">\n                  {`>>`} PAYMENT CONFIRMED [BLOCK 834...]\n                </p>\n              )}\n              {paymentResult === \"error\" && (\n                <p className=\"text-xs text-red-500 mt-2\">\n                  {`>>`} ERROR: ROUTE_FAILED\n                </p>\n              )}\n            </div>\n\n            <button\n              onClick={onDisconnect}\n              className=\"w-full py-3 border border-red-900/30 text-red-500/80 rounded-lg hover:bg-red-900/10 transition-colors text-xs flex items-center justify-center uppercase tracking-widest\"\n            >\n              <LogOut className=\"w-3 h-3 mr-2\" /> Terminate Session\n            </button>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            <div className=\"bg-charcoal-light p-4 rounded-lg text-xs text-gray-400 border-l-2 border-bitcoin\">\n              Initialize connection using <strong>NIP-47</strong> string. Keys\n              remain on your remote signer (Alby/Mutiny).\n            </div>\n\n            <textarea\n              className=\"w-full h-24 p-3 bg-black border border-charcoal-light rounded-lg text-[10px] font-mono text-gray-300 focus:border-bitcoin outline-none resize-none\"\n              placeholder=\"nostr+walletconnect://...\"\n              value={nwcString}\n              onChange={(e) => setNwcString(e.target.value)}\n            />\n\n            <button\n              onClick={() => onConnect(nwcString)}\n              disabled={status === \"connecting\" || !nwcString}\n              className=\"w-full bg-bitcoin text-black font-bold py-3 rounded-lg hover:brightness-110 transition-all disabled:opacity-50 flex items-center justify-center gap-2 uppercase tracking-wide text-xs\"\n            >\n              {status === \"connecting\" ? \"Handshaking...\" : \"Initialize Uplink\"}\n              <Zap className=\"w-4 h-4 fill-black\" />\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1549, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/components/hub/HubDrawer.tsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { BITCOIN_HUBS } from \"@/lib/constants\";\nimport { Plane, Search, X, Signal, Loader2, MapPin } from \"lucide-react\";\nimport { useSession } from \"@/contexts/NostrSessionContext\";\nimport { calculateCityPulse } from \"@/lib/scoring\";\nimport { generateCityId } from \"@/lib/geoutils\";\n\ninterface HubDrawerProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSelect: (lat: number, lon: number, name: string) => void;\n}\n\nexport default function HubDrawer({\n  isOpen,\n  onClose,\n  onSelect,\n}: HubDrawerProps) {\n  const { ndk } = useSession();\n  const [query, setQuery] = useState(\"\");\n  const [hubStats, setHubStats] = useState<Record<string, number>>({});\n  const [loadingStats, setLoadingStats] = useState(false);\n\n  useEffect(() => {\n    if (isOpen && ndk) {\n      setLoadingStats(true);\n\n      Promise.all(\n        BITCOIN_HUBS.map(async (hub) => {\n          // 1. Generate Canonical ID for the Hub coordinates\n          // This ensures we are querying the exact ID the app produces\n          const { cityId } = generateCityId(hub.lat, hub.lon);\n\n          try {\n            // 2. Query via NIP-12 Generic Tag Search\n            const events = await ndk.fetchEvents({\n              kinds: [1],\n              \"#t\": [\"satsrover\"],\n              // We filter by city_id tag.\n              // Note: Not all relays support generic tag queries, so we rely on #t satsrover first\n              // and filter client-side if needed, but optimally the relay handles this.\n              \"#city_id\": [cityId],\n              limit: 50,\n            });\n\n            const stats = calculateCityPulse(Array.from(events));\n            return { name: hub.name, score: stats.totalScore };\n          } catch (e) {\n            return { name: hub.name, score: 0 };\n          }\n        })\n      ).then((results) => {\n        const statsMap: Record<string, number> = {};\n        results.forEach((r) => (statsMap[r.name] = r.score));\n        setHubStats(statsMap);\n        setLoadingStats(false);\n      });\n    }\n  }, [isOpen, ndk]);\n\n  if (!isOpen) return null;\n\n  const handleSearch = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!query.trim()) return;\n    try {\n      const res = await fetch(\n        `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`,\n        { headers: { \"User-Agent\": \"SatsRover\" } }\n      );\n      const data = await res.json();\n      if (data && data.length > 0) {\n        onSelect(parseFloat(data[0].lat), parseFloat(data[0].lon), query);\n        onClose();\n      }\n    } catch (e) {\n      alert(\"Search failed\");\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none\">\n      <div\n        className=\"absolute inset-0 bg-black/80 backdrop-blur-md pointer-events-auto\"\n        onClick={onClose}\n      />\n\n      <div className=\"relative w-full max-w-md bg-[#121212] border border-white/10 rounded-t-2xl sm:rounded-2xl p-6 pointer-events-auto shadow-2xl animate-in slide-in-from-bottom text-white font-mono h-[80vh] flex flex-col\">\n        <div className=\"flex justify-between items-center mb-6 border-b border-white/10 pb-4 shrink-0\">\n          <h2 className=\"text-lg font-bold flex items-center gap-2 text-bitcoin\">\n            <Plane className=\"w-5 h-5\" />\n            TELEPORT_UPLINK\n          </h2>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-white/10 rounded-full text-gray-400\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        <form onSubmit={handleSearch} className=\"mb-6 relative shrink-0\">\n          <Search className=\"absolute left-3 top-3 w-4 h-4 text-gray-500\" />\n          <input\n            className=\"w-full bg-white/5 border border-white/10 rounded-xl py-3 pl-10 text-sm text-white focus:border-bitcoin outline-none transition-colors\"\n            placeholder=\"Search global coordinates...\"\n            value={query}\n            onChange={(e) => setQuery(e.target.value)}\n          />\n        </form>\n\n        <div className=\"flex justify-between items-end mb-3 shrink-0\">\n          <h3 className=\"text-xs font-bold text-gray-500 uppercase tracking-widest\">\n            Active Sectors\n          </h3>\n          {loadingStats && (\n            <Loader2 className=\"w-3 h-3 animate-spin text-bitcoin\" />\n          )}\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto min-h-0 space-y-2 pr-1 scrollbar-hide\">\n          {BITCOIN_HUBS.map((hub) => {\n            const signalScore = hubStats[hub.name] || 0;\n            const isHot = signalScore > 10;\n\n            return (\n              <button\n                key={hub.name}\n                onClick={() => {\n                  onSelect(hub.lat, hub.lon, hub.name);\n                  onClose();\n                }}\n                className=\"w-full flex items-center justify-between p-4 bg-white/5 rounded-xl hover:bg-white/10 border border-transparent hover:border-bitcoin/30 transition-all group\"\n              >\n                <div className=\"flex flex-col items-start\">\n                  <span className=\"text-sm font-bold text-white group-hover:text-bitcoin transition-colors flex items-center gap-2\">\n                    {hub.name}{\" \"}\n                    <span className=\"opacity-50 text-xs font-normal\">\n                      {hub.country}\n                    </span>\n                  </span>\n                  <span className=\"text-[10px] text-gray-500 mt-0.5\">\n                    {hub.desc}\n                  </span>\n                </div>\n\n                <div\n                  className={`flex items-center gap-2 px-2.5 py-1.5 rounded-lg border ${isHot ? \"bg-bitcoin/10 border-bitcoin/30 text-bitcoin\" : \"bg-white/5 border-white/5 text-gray-600\"}`}\n                >\n                  <Signal\n                    className={`w-3 h-3 ${isHot ? \"animate-pulse\" : \"\"}`}\n                  />\n                  <span className=\"text-xs font-bold font-mono\">\n                    {signalScore.toFixed(1)}\n                  </span>\n                </div>\n              </button>\n            );\n          })}\n        </div>\n\n        <div className=\"mt-4 pt-4 border-t border-white/10 text-center shrink-0\">\n          <p className=\"text-[9px] text-gray-600 uppercase tracking-widest\">\n            City Pulse v1.0 // Deterministic Signal Aggregation\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1884, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/components/earn/EarnDrawer.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { Trophy, Map, Zap, X, Loader2, Shield, Target } from \"lucide-react\";\nimport { useSession } from \"@/contexts/NostrSessionContext\";\nimport { cn } from \"@/lib/utils\";\nimport { Share2 } from \"lucide-react\";\n\ninterface EarnDrawerProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport default function EarnDrawer({ isOpen, onClose }: EarnDrawerProps) {\n  const { ndk, session } = useSession();\n  const [checkInCount, setCheckInCount] = useState(0);\n  const [loading, setLoading] = useState(false);\n\n  // Fetch real user stats from Nostr when drawer opens\n  useEffect(() => {\n    if (isOpen && session.type !== \"anon\" && session.pubkey && ndk) {\n      setLoading(true);\n      // Query: \"How many kind 1 events has this user published with #satsrover tag?\"\n      ndk\n        .fetchEvents({\n          authors: [session.pubkey],\n          kinds: [1],\n          \"#t\": [\"satsrover\"],\n        })\n        .then((events) => {\n          setCheckInCount(events.size);\n          setLoading(false);\n        });\n    }\n  }, [isOpen, session, ndk]);\n\n  if (!isOpen) return null;\n\n  // Calculate Rank based on check-ins\n  const rankLevel = Math.floor(checkInCount / 3) + 1;\n  const rankTitle =\n    rankLevel === 1\n      ? \"NOVICE SCOUT\"\n      : rankLevel === 2\n        ? \"FIELD AGENT\"\n        : rankLevel === 3\n          ? \"NODE RUNNER\"\n          : \"CYPHERPUNK\";\n  // NEW: Share Function\n  const handleShare = () => {\n    const text = `I'm exploring the sovereign web with #SatsRover üåç‚ö°\\n\\nRank: ${rankTitle}\\nCheck-ins: ${checkInCount}\\n\\nJoin the hunt: https://satsrover.vercel.app`;\n    if (navigator.share) {\n      navigator\n        .share({\n          title: \"SatsRover Status\",\n          text,\n          url: \"https://satsrover.vercel.app\",\n        })\n        .catch(console.error);\n    } else {\n      navigator.clipboard.writeText(text);\n      alert(\"Stats copied to clipboard! Paste it on Nostr.\");\n    }\n  };\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none\">\n      <div\n        className=\"absolute inset-0 bg-black/80 backdrop-blur-md pointer-events-auto\"\n        onClick={onClose}\n      />\n\n      <div className=\"relative w-full max-w-md bg-[#121212] border border-white/10 rounded-t-2xl sm:rounded-2xl p-6 pointer-events-auto shadow-2xl animate-in slide-in-from-bottom text-white font-mono\">\n        {/* Header */}\n        <div className=\"flex justify-between items-center mb-6 border-b border-white/10 pb-4\">\n          <h2 className=\"text-lg font-bold flex items-center gap-2 text-bitcoin\">\n            <Trophy className=\"w-5 h-5\" />\n            PROOF_OF_PRESENCE\n          </h2>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-white/10 rounded-full text-gray-400\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        {session.type === \"anon\" ? (\n          <div className=\"text-center py-12 border border-dashed border-white/20 rounded-xl\">\n            <Shield className=\"w-12 h-12 text-gray-600 mx-auto mb-3\" />\n            <p className=\"text-gray-400 text-sm\">IDENTITY_REQUIRED</p>\n            <p className=\"text-[10px] text-gray-600 mt-1\">\n              Connect Nostr to track reputation.\n            </p>\n          </div>\n        ) : (\n          <div className=\"space-y-6\">\n            {/* Main Stats Grid */}\n            <div className=\"grid grid-cols-2 gap-3\">\n              {/* Check-in Counter */}\n              <div className=\"bg-white/5 p-4 rounded-xl border border-white/5 flex flex-col items-center justify-center relative overflow-hidden group\">\n                <div className=\"absolute inset-0 bg-bitcoin/5 transform scale-0 group-hover:scale-100 transition-transform duration-500\" />\n                <span className=\"text-4xl font-bold text-bitcoin z-10\">\n                  {loading ? (\n                    <Loader2 className=\"animate-spin w-8 h-8 opacity-50\" />\n                  ) : (\n                    checkInCount\n                  )}\n                </span>\n                <span className=\"text-[10px] text-gray-500 uppercase tracking-[0.2em] mt-2 z-10\">\n                  Check-ins\n                </span>\n              </div>\n\n              {/* Rank Display */}\n              <div className=\"bg-white/5 p-4 rounded-xl border border-white/5 flex flex-col items-center justify-center relative overflow-hidden\">\n                <span className=\"text-3xl font-bold text-matrix z-10\">\n                  LVL {rankLevel}\n                </span>\n                <span className=\"text-[9px] text-matrix/70 uppercase tracking-widest mt-2 z-10\">\n                  {rankTitle}\n                </span>\n              </div>\n            </div>\n\n            {/* Missions List */}\n            <div>\n              <h3 className=\"text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-3 flex items-center gap-2\">\n                <Target className=\"w-3 h-3\" /> Active Missions\n              </h3>\n\n              <div className=\"space-y-2\">\n                <MissionRow\n                  icon={Map}\n                  title=\"First Contact\"\n                  desc=\"Post your 1st Check-in\"\n                  completed={checkInCount >= 1}\n                />\n                <MissionRow\n                  icon={Zap}\n                  title=\"Signal Booster\"\n                  desc=\"Post 3 Check-ins\"\n                  completed={checkInCount >= 3}\n                />\n                <MissionRow\n                  icon={Shield}\n                  title=\"Trust Anchor\"\n                  desc=\"Post 10 Check-ins\"\n                  completed={checkInCount >= 10}\n                />\n              </div>\n            </div>\n            {/* Add this button below the Missions List */}\n            <button\n              onClick={handleShare}\n              className=\"w-full mt-6 py-4 border border-bitcoin/30 bg-bitcoin/5 text-bitcoin rounded-xl flex items-center justify-center gap-2 hover:bg-bitcoin/10 transition-all group\"\n            >\n              <Share2 className=\"w-4 h-4 group-hover:scale-110 transition-transform\" />\n              <span className=\"text-xs font-bold uppercase tracking-widest\">\n                Share Protocol Status\n              </span>\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction MissionRow({ icon: Icon, title, desc, completed }: any) {\n  return (\n    <div\n      className={cn(\n        \"flex items-center gap-4 p-3 rounded-lg border transition-all duration-300\",\n        completed\n          ? \"bg-bitcoin/10 border-bitcoin/30\"\n          : \"bg-white/5 border-white/5 opacity-60 hover:opacity-100\"\n      )}\n    >\n      <div\n        className={cn(\n          \"w-10 h-10 rounded-full flex items-center justify-center border\",\n          completed\n            ? \"bg-bitcoin text-black border-bitcoin shadow-[0_0_10px_#F7931A]\"\n            : \"bg-white/5 text-gray-500 border-white/10\"\n        )}\n      >\n        <Icon className=\"w-5 h-5\" />\n      </div>\n\n      <div className=\"flex-1\">\n        <div className=\"flex justify-between items-center\">\n          <p\n            className={cn(\n              \"text-xs font-bold uppercase tracking-wide\",\n              completed ? \"text-bitcoin\" : \"text-gray-300\"\n            )}\n          >\n            {title}\n          </p>\n          {completed && (\n            <span className=\"text-[8px] bg-bitcoin/20 text-bitcoin px-1.5 py-0.5 rounded border border-bitcoin/30\">\n              DONE\n            </span>\n          )}\n        </div>\n        <p className=\"text-[10px] text-gray-500 mt-0.5 font-sans\">{desc}</p>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2315, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/components/earn/ActivityDrawer.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { Activity, Radio, X, Loader2, Zap, MapPin } from \"lucide-react\";\nimport { useSession } from \"@/contexts/NostrSessionContext\";\nimport { NDKUserProfile } from \"@nostr-dev-kit/ndk\";\n\ninterface ActivityDrawerProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\ninterface SignalEvent {\n  id: string;\n  pubkey: string;\n  content: string;\n  created_at: number;\n  profile?: NDKUserProfile;\n  location?: string;\n}\n\n// Helper for dynamic date\nfunction getNextFriday() {\n  const d = new Date();\n  const day = d.getDay();\n  const diff = 5 - day;\n  const daysToAdd = diff >= 0 ? diff : 6 + diff;\n  d.setDate(d.getDate() + daysToAdd);\n  return d.toLocaleDateString(\"en-US\", { month: \"short\", day: \"numeric\" });\n}\n\nexport default function ActivityDrawer({\n  isOpen,\n  onClose,\n}: ActivityDrawerProps) {\n  const { ndk } = useSession();\n  const [signals, setSignals] = useState<SignalEvent[]>([]);\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    if (isOpen && ndk) {\n      setLoading(true);\n      ndk\n        .fetchEvents({\n          kinds: [1],\n          \"#t\": [\"satsrover\"],\n          limit: 50,\n        })\n        .then(async (events) => {\n          const sorted = Array.from(events).sort(\n            (a, b) => b.created_at! - a.created_at!\n          );\n\n          const enriched = await Promise.all(\n            sorted.slice(0, 20).map(async (e) => {\n              const user = ndk.getUser({ pubkey: e.pubkey });\n              // Safe profile fetch\n              const profileData = await user.fetchProfile();\n              const profile = profileData || undefined;\n\n              // ‚úÖ ROBUST PARSING\n              let location = \"Unknown Location\";\n              const cityTag = e.tags.find((t) => t[0] === \"city\")?.[1];\n              const countryTag = e.tags.find((t) => t[0] === \"country\")?.[1];\n\n              if (cityTag) {\n                location = countryTag ? `${cityTag}, ${countryTag}` : cityTag;\n              } else {\n                const match = e.content.match(/Checking in at (.*?) ‚ö°/);\n                if (match) location = match[1];\n              }\n\n              return {\n                id: e.id,\n                pubkey: e.pubkey,\n                content: e.content,\n                created_at: e.created_at!,\n                profile,\n                location,\n              };\n            })\n          );\n\n          setSignals(enriched);\n          setLoading(false);\n        });\n    }\n  }, [isOpen, ndk]);\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none\">\n      <div\n        className=\"absolute inset-0 bg-black/80 backdrop-blur-md pointer-events-auto\"\n        onClick={onClose}\n      />\n\n      <div className=\"relative w-full max-w-md bg-[#121212] border border-white/10 rounded-t-2xl sm:rounded-2xl p-6 pointer-events-auto shadow-2xl animate-in slide-in-from-bottom text-white font-mono h-[80vh] flex flex-col\">\n        <div className=\"flex justify-between items-center mb-6 border-b border-white/10 pb-4 shrink-0\">\n          <h2 className=\"text-lg font-bold flex items-center gap-2 text-bitcoin\">\n            <Radio className=\"w-5 h-5 text-[#00FF41] animate-pulse\" />\n            GLOBAL_FEED\n          </h2>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-white/10 rounded-full text-gray-400\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        {/* Banner */}\n        <div className=\"mb-6 bg-linear-to-r from-bitcoin/20 to-transparent p-4 rounded-xl border border-bitcoin/30 shrink-0 relative overflow-hidden group\">\n          <div className=\"absolute -right-4 -top-4 w-16 h-16 bg-bitcoin/20 rounded-full blur-xl group-hover:bg-bitcoin/40 transition-all\" />\n          <div className=\"flex justify-between items-start relative z-10\">\n            <div>\n              <p className=\"text-[10px] font-bold text-bitcoin uppercase tracking-widest mb-1\">\n                Weekly Reward Pool\n              </p>\n              <p className=\"text-3xl font-bold text-white\">\n                2,100{\" \"}\n                <span className=\"text-sm font-normal text-gray-400\">sats</span>\n              </p>\n            </div>\n            <Zap className=\"w-8 h-8 text-bitcoin fill-bitcoin\" />\n          </div>\n          <div className=\"mt-3 flex items-center gap-2\">\n            <div className=\"px-2 py-0.5 rounded bg-bitcoin/20 border border-bitcoin/30 text-[9px] font-bold text-bitcoin uppercase\">\n              Next Draw: {getNextFriday()}\n            </div>\n            <p className=\"text-[10px] text-gray-400\">Draws every Friday</p>\n          </div>\n        </div>\n\n        {/* Feed List */}\n        <div className=\"flex-1 overflow-y-auto min-h-0 space-y-4 pr-1 scrollbar-hide\">\n          {loading ? (\n            <div className=\"flex flex-col items-center justify-center h-40 gap-3 text-bitcoin\">\n              <Loader2 className=\"w-6 h-6 animate-spin\" />\n              <span className=\"text-xs uppercase tracking-widest\">\n                Scanning Frequencies...\n              </span>\n            </div>\n          ) : (\n            signals.map((signal) => (\n              <div\n                key={signal.id}\n                className=\"relative pl-4 border-l border-white/10 pb-4 last:border-0 last:pb-0\"\n              >\n                <div className=\"absolute -left-1.25 top-0 w-2.5 h-2.5 rounded-full bg-[#121212] border border-white/30\" />\n                <div className=\"flex items-start gap-3\">\n                  {signal.profile?.image ? (\n                    <img\n                      src={signal.profile.image}\n                      className=\"w-8 h-8 rounded bg-gray-800 object-cover border border-white/10\"\n                      alt=\"\"\n                    />\n                  ) : (\n                    <div className=\"w-8 h-8 rounded bg-white/5 flex items-center justify-center text-[10px] font-bold border border-white/10\">\n                      {signal.pubkey.slice(0, 2)}\n                    </div>\n                  )}\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex justify-between items-baseline\">\n                      <p className=\"text-xs font-bold text-gray-300 truncate\">\n                        {signal.profile?.name || \"Anon Scout\"}\n                      </p>\n                      <span className=\"text-[9px] text-gray-600\">\n                        {timeAgo(signal.created_at)}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center gap-1 text-bitcoin text-[10px] mt-0.5 mb-1 truncate\">\n                      <MapPin className=\"w-3 h-3\" />\n                      <span className=\"uppercase tracking-wide\">\n                        {signal.location}\n                      </span>\n                    </div>\n                    <p className=\"text-xs text-gray-500 line-clamp-2 leading-relaxed\">\n                      {signal.content\n                        .replace(/Checking in at .* ‚ö° #SatsRover/, \"\")\n                        .replace(/‚úÖ|‚ùå|üëÄ/, \"\")\n                        .trim()}\n                    </p>\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction timeAgo(timestamp: number) {\n  const seconds = Math.floor(Date.now() / 1000 - timestamp);\n  if (seconds < 60) return `${seconds}s ago`;\n  const minutes = Math.floor(seconds / 60);\n  if (minutes < 60) return `${minutes}m ago`;\n  const hours = Math.floor(minutes / 60);\n  if (hours < 24) return `${hours}h ago`;\n  return `${Math.floor(hours / 24)}d ago`;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2733, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/components/ui/ManifestoDrawer.tsx"],"sourcesContent":["import React from \"react\";\nimport { Fingerprint, X } from \"lucide-react\";\n\ninterface ManifestoDrawerProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport default function ManifestoDrawer({\n  isOpen,\n  onClose,\n}: ManifestoDrawerProps) {\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none\">\n      <div\n        className=\"absolute inset-0 bg-black/80 backdrop-blur-md pointer-events-auto\"\n        onClick={onClose}\n      />\n\n      <div className=\"relative w-full max-w-md bg-[#121212] border border-white/10 rounded-t-2xl sm:rounded-2xl p-8 pointer-events-auto shadow-2xl animate-in slide-in-from-bottom text-gray-300 font-mono leading-relaxed h-[80vh] overflow-y-auto\">\n        <div className=\"flex justify-between items-center mb-8\">\n          <Fingerprint className=\"w-8 h-8 text-[#F7931A]\" />\n          <button onClick={onClose}>\n            <X className=\"w-6 h-6\" />\n          </button>\n        </div>\n\n        <h1 className=\"text-2xl font-bold text-white mb-6\">\n          Why SatsRover Exists\n        </h1>\n\n        <div className=\"space-y-6 text-sm\">\n          <p>\n            The internet maps places.\n            <br />\n            <span className=\"text-white font-bold\">Bitcoin maps truth.</span>\n          </p>\n\n          <p>\n            Google Maps cannot tell you if freedom works there. Payment\n            processors cannot tell you if sovereignty survives there.\n          </p>\n\n          <p>\n            SatsRover does not \"certify\" merchants. We record{\" \"}\n            <span className=\"text-[#00FF41]\">signals</span>.\n          </p>\n\n          <ul className=\"list-disc pl-4 space-y-2 text-gray-400\">\n            <li>Every marker is a claim.</li>\n            <li>Every glow is earned.</li>\n            <li>Every truth is emergent.</li>\n          </ul>\n\n          <p>\n            We do not aggregate trust. We let it form. No accounts. No\n            gatekeepers.\n          </p>\n\n          <p className=\"pt-4 border-t border-white/10 text-xs text-gray-500\">\n            v1.0 // CYHERPUNK_EDITION\n            <br />\n            Built for the Sovereign Individual.\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AACA;AAAA;;;AAOe,SAAS,gBAAgB,EACtC,MAAM,EACN,OAAO,EACc;IACrB,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,8VAAC;QAAI,WAAU;;0BACb,8VAAC;gBACC,WAAU;gBACV,SAAS;;;;;;0BAGX,8VAAC;gBAAI,WAAU;;kCACb,8VAAC;wBAAI,WAAU;;0CACb,8VAAC,iUAAW;gCAAC,WAAU;;;;;;0CACvB,8VAAC;gCAAO,SAAS;0CACf,cAAA,8VAAC,wRAAC;oCAAC,WAAU;;;;;;;;;;;;;;;;;kCAIjB,8VAAC;wBAAG,WAAU;kCAAqC;;;;;;kCAInD,8VAAC;wBAAI,WAAU;;0CACb,8VAAC;;oCAAE;kDAED,8VAAC;;;;;kDACD,8VAAC;wCAAK,WAAU;kDAAuB;;;;;;;;;;;;0CAGzC,8VAAC;0CAAE;;;;;;0CAKH,8VAAC;;oCAAE;oCACiD;kDAClD,8VAAC;wCAAK,WAAU;kDAAiB;;;;;;oCAAc;;;;;;;0CAGjD,8VAAC;gCAAG,WAAU;;kDACZ,8VAAC;kDAAG;;;;;;kDACJ,8VAAC;kDAAG;;;;;;kDACJ,8VAAC;kDAAG;;;;;;;;;;;;0CAGN,8VAAC;0CAAE;;;;;;0CAKH,8VAAC;gCAAE,WAAU;;oCAAsD;kDAEjE,8VAAC;;;;;oCAAK;;;;;;;;;;;;;;;;;;;;;;;;;AAOlB;KA9DwB"}},
    {"offset": {"line": 2929, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/components/auth/AuthDrawer.tsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport {\n  X,\n  KeyRound,\n  UserPlus,\n  Copy,\n  Check,\n  ShieldAlert,\n  ArrowRight,\n  Upload,\n} from \"lucide-react\";\nimport { useSession } from \"@/contexts/NostrSessionContext\";\n\ninterface AuthDrawerProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\ntype AuthStep = \"menu\" | \"login\" | \"create_profile\" | \"backup\";\n\nexport default function AuthDrawer({ isOpen, onClose }: AuthDrawerProps) {\n  const { loginWithExtension, loginWithNsec, signup, updateProfile, session } =\n    useSession();\n\n  const [step, setStep] = useState<AuthStep>(\"menu\");\n  const [nsecInput, setNsecInput] = useState(\"\");\n  const [createdNsec, setCreatedNsec] = useState<string | null>(null);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    about: \"\",\n    picture: \"\",\n  });\n  const [copied, setCopied] = useState(false);\n  const [loading, setLoading] = useState(false);\n\n  // Persistence Toggle\n  const [rememberMe, setRememberMe] = useState(true);\n\n  // Close if logged in\n  useEffect(() => {\n    if (session.type !== \"anon\") onClose();\n  }, [session.type, onClose]);\n\n  // Reset on open\n  useEffect(() => {\n    if (isOpen) {\n      setStep(\"menu\");\n      setNsecInput(\"\");\n      setCreatedNsec(null);\n      setFormData({ name: \"\", about: \"\", picture: \"\" });\n    }\n  }, [isOpen]);\n\n  if (!isOpen || session.type !== \"anon\") return null;\n\n  // Handlers\n  const handleStartSignup = async () => {\n    setLoading(true);\n    // ‚úÖ PASS rememberMe to signup\n    const result = await signup(rememberMe);\n    if (result) {\n      setCreatedNsec(result.nsec);\n      const randomAvatar = `https://api.dicebear.com/9.x/bottts-neutral/svg?seed=${result.user.pubkey}`;\n      setFormData((prev) => ({ ...prev, picture: randomAvatar }));\n      setStep(\"create_profile\");\n    }\n    setLoading(false);\n  };\n\n  const handleSaveProfile = async () => {\n    setLoading(true);\n    await updateProfile(formData.name, formData.about, formData.picture);\n    setLoading(false);\n    setStep(\"backup\");\n  };\n\n  const handleNsecLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!nsecInput.startsWith(\"nsec1\")) return alert(\"Invalid nsec\");\n    // ‚úÖ PASS rememberMe to login\n    await loginWithNsec(nsecInput, rememberMe);\n    onClose();\n  };\n\n  const copyToClipboard = () => {\n    if (createdNsec) {\n      navigator.clipboard.writeText(createdNsec);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none\">\n      <div\n        className=\"absolute inset-0 bg-black/80 backdrop-blur-md pointer-events-auto\"\n        onClick={onClose}\n      />\n\n      <div className=\"relative w-full max-w-md bg-[#121212] border border-white/10 rounded-t-2xl sm:rounded-2xl p-6 pointer-events-auto shadow-2xl animate-in slide-in-from-bottom text-white font-mono\">\n        <div className=\"flex justify-between items-center mb-6 border-b border-white/10 pb-4\">\n          <h2 className=\"text-lg font-bold flex items-center gap-2 text-bitcoin\">\n            <KeyRound className=\"w-5 h-5\" />\n            NOSTR_IDENTITY\n          </h2>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-white/10 rounded-full text-gray-400\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        {/* STEP 1: MENU */}\n        {step === \"menu\" && (\n          <div className=\"space-y-4\">\n            <button\n              onClick={handleStartSignup}\n              disabled={loading}\n              className=\"w-full py-5 bg-bitcoin text-black font-bold rounded-xl flex items-center justify-between px-6 hover:brightness-110 transition-all group\"\n            >\n              <span className=\"uppercase tracking-widest text-sm\">\n                {loading ? \"Generating...\" : \"Create Account\"}\n              </span>\n              <UserPlus className=\"w-5 h-5 opacity-50 group-hover:opacity-100 transition-opacity\" />\n            </button>\n\n            <div className=\"flex items-center justify-center gap-2 mb-2\">\n              <input\n                type=\"checkbox\"\n                id=\"remember_signup\"\n                checked={rememberMe}\n                onChange={(e) => setRememberMe(e.target.checked)}\n                className=\"accent-bitcoin w-4 h-4 cursor-pointer\"\n              />\n              <label\n                htmlFor=\"remember_signup\"\n                className=\"text-xs text-gray-400 select-none cursor-pointer\"\n              >\n                Keep me logged in\n              </label>\n            </div>\n\n            <div className=\"flex items-center gap-4 my-4\">\n              <div className=\"h-px bg-white/10 flex-1\" />\n              <span className=\"text-[10px] text-gray-600 uppercase tracking-widest\">\n                Or\n              </span>\n              <div className=\"h-px bg-white/10 flex-1\" />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-3\">\n              <button\n                onClick={() => {\n                  setStep(\"login\");\n                  setRememberMe(false);\n                }}\n                className=\"py-4 bg-white/5 border border-white/10 rounded-xl hover:bg-white/10 transition-all flex flex-col items-center gap-2\"\n              >\n                <KeyRound className=\"w-5 h-5 text-gray-400\" />\n                <span className=\"text-[10px] font-bold text-gray-300 uppercase tracking-wider\">\n                  Use Key\n                </span>\n              </button>\n              <button\n                onClick={() => loginWithExtension().then(onClose)}\n                className=\"py-4 bg-white/5 border border-white/10 rounded-xl hover:bg-white/10 transition-all flex flex-col items-center gap-2\"\n              >\n                <UserPlus className=\"w-5 h-5 text-gray-400\" />\n                <span className=\"text-[10px] font-bold text-gray-300 uppercase tracking-wider\">\n                  Extension\n                </span>\n              </button>\n            </div>\n          </div>\n        )}\n\n        {/* STEP 2: LOGIN */}\n        {step === \"login\" && (\n          <form onSubmit={handleNsecLogin} className=\"space-y-4\">\n            <div>\n              <label className=\"text-xs text-gray-500 uppercase tracking-widest block mb-2\">\n                Private Key (nsec)\n              </label>\n              <input\n                type=\"password\"\n                placeholder=\"nsec1...\"\n                autoFocus\n                className=\"w-full bg-black/50 border border-white/10 rounded-lg p-4 text-sm text-white focus:border-bitcoin outline-none font-mono\"\n                value={nsecInput}\n                onChange={(e) => setNsecInput(e.target.value)}\n              />\n            </div>\n\n            <div className=\"flex items-center gap-3 bg-white/5 p-3 rounded-lg border border-white/5\">\n              <input\n                type=\"checkbox\"\n                id=\"remember_login\"\n                checked={rememberMe}\n                onChange={(e) => setRememberMe(e.target.checked)}\n                className=\"accent-bitcoin w-4 h-4 cursor-pointer\"\n              />\n              <label\n                htmlFor=\"remember_login\"\n                className=\"text-xs text-gray-300 cursor-pointer select-none\"\n              >\n                Stay logged in on this device\n              </label>\n            </div>\n\n            <button\n              type=\"submit\"\n              className=\"w-full py-4 bg-bitcoin text-black font-bold rounded-lg text-sm uppercase tracking-widest hover:brightness-110\"\n            >\n              Connect\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => setStep(\"menu\")}\n              className=\"w-full py-3 text-gray-500 text-xs hover:text-white\"\n            >\n              Back\n            </button>\n          </form>\n        )}\n\n        {/* STEP 3: CREATE PROFILE */}\n        {step === \"create_profile\" && (\n          <div className=\"space-y-6\">\n            <div className=\"text-center\">\n              <div className=\"w-24 h-24 mx-auto bg-white/5 rounded-full p-1 border-2 border-bitcoin relative overflow-hidden group\">\n                {/* eslint-disable-next-line @next/next/no-img-element */}\n                <img\n                  src={formData.picture}\n                  alt=\"Avatar\"\n                  className=\"w-full h-full rounded-full object-cover\"\n                />\n              </div>\n              <p className=\"text-[10px] text-gray-500 mt-2 uppercase tracking-widest\">\n                Your Digital Self\n              </p>\n            </div>\n            <div className=\"space-y-3\">\n              <input\n                type=\"text\"\n                placeholder=\"Username\"\n                autoFocus\n                className=\"w-full bg-white/5 border border-white/10 rounded-lg p-3 text-white focus:border-bitcoin outline-none\"\n                value={formData.name}\n                onChange={(e) =>\n                  setFormData({ ...formData, name: e.target.value })\n                }\n              />\n              <input\n                type=\"text\"\n                placeholder=\"Bio (Optional)\"\n                className=\"w-full bg-white/5 border border-white/10 rounded-lg p-3 text-white focus:border-bitcoin outline-none\"\n                value={formData.about}\n                onChange={(e) =>\n                  setFormData({ ...formData, about: e.target.value })\n                }\n              />\n            </div>\n            <button\n              onClick={handleSaveProfile}\n              disabled={!formData.name || loading}\n              className=\"w-full py-4 bg-bitcoin text-black font-bold rounded-lg text-sm uppercase tracking-widest hover:brightness-110 flex items-center justify-center gap-2 disabled:opacity-50\"\n            >\n              {loading ? (\n                \"Publishing...\"\n              ) : (\n                <>\n                  Save Profile <ArrowRight className=\"w-4 h-4\" />\n                </>\n              )}\n            </button>\n          </div>\n        )}\n\n        {/* STEP 4: BACKUP */}\n        {step === \"backup\" && (\n          <div className=\"space-y-6 animate-in fade-in\">\n            <div className=\"bg-bitcoin/10 p-4 rounded-lg border border-bitcoin/30 text-center\">\n              <h3 className=\"text-bitcoin font-bold text-lg mb-1\">\n                Identity Created\n              </h3>\n              <p className=\"text-xs text-gray-400\">Welcome to the network.</p>\n            </div>\n            <div className=\"bg-red-500/5 border border-red-500/20 p-4 rounded-xl\">\n              <div className=\"flex items-center gap-2 text-red-500 mb-2\">\n                <ShieldAlert className=\"w-4 h-4\" />\n                <span className=\"text-xs font-bold uppercase tracking-widest\">\n                  Secret Key Backup\n                </span>\n              </div>\n              <p className=\"text-[10px] text-gray-400 mb-4 leading-relaxed\">\n                This key is the <strong>only way</strong> to access your\n                account.\n              </p>\n              <div className=\"relative\">\n                <input\n                  readOnly\n                  value={createdNsec || \"\"}\n                  className=\"w-full bg-black/50 border border-white/10 rounded-lg p-3 pr-10 text-xs text-bitcoin font-mono focus:outline-none\"\n                />\n                <button\n                  onClick={copyToClipboard}\n                  className=\"absolute right-2 top-2 p-1 hover:bg-white/10 rounded text-gray-400\"\n                >\n                  {copied ? (\n                    <Check className=\"w-4 h-4 text-matrix\" />\n                  ) : (\n                    <Copy className=\"w-4 h-4\" />\n                  )}\n                </button>\n              </div>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"w-full py-4 bg-white/10 text-white font-bold rounded-lg text-sm uppercase tracking-widest hover:bg-white/20\"\n            >\n              I Have Saved My Key\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3586, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/components/layout/Sidebar.tsx"],"sourcesContent":["import React, { useState } from \"react\";\nimport {\n  User,\n  Radio,\n  Trophy,\n  Fingerprint,\n  LogOut,\n  X,\n  ChevronRight,\n  Copy,\n  Check,\n} from \"lucide-react\";\nimport { useSession } from \"@/contexts/NostrSessionContext\";\nimport { cn } from \"@/lib/utils\";\nimport { nip19 } from \"nostr-tools\";\n\ninterface SidebarProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onNavigate: (view: string) => void;\n}\n\nexport default function Sidebar({ isOpen, onClose, onNavigate }: SidebarProps) {\n  const { session, logout } = useSession();\n  const [copied, setCopied] = useState(false);\n\n  // Derive npub safely\n  const npub = session.pubkey ? nip19.npubEncode(session.pubkey) : \"\";\n  const displayNpub = npub ? `${npub.slice(0, 10)}...${npub.slice(-4)}` : \"\";\n\n  const copyNpub = () => {\n    if (!npub) return;\n    navigator.clipboard.writeText(npub);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  if (session.type === \"anon\") return null; // Hard Guard: Sidebar only for Identity\n\n  return (\n    <>\n      <div\n        className={cn(\n          \"fixed inset-0 bg-black/80 backdrop-blur-sm z-40 transition-opacity duration-300\",\n          isOpen\n            ? \"opacity-100 pointer-events-auto\"\n            : \"opacity-0 pointer-events-none\"\n        )}\n        onClick={onClose}\n      />\n\n      <div\n        className={cn(\n          \"fixed inset-y-0 left-0 w-3/4 max-w-70 bg-[#0A0A0A] border-r border-white/10 z-50 transform transition-transform duration-300 ease-out flex flex-col font-mono\",\n          isOpen ? \"translate-x-0\" : \"-translate-x-full\"\n        )}\n      >\n        {/* IDENTITY HEADER */}\n        <div className=\"p-6 border-b border-white/10 bg-[#121212]\">\n          <div className=\"flex justify-between items-start mb-6\">\n            <h1 className=\"text-xl font-bold text-white tracking-tighter\">\n              SATS<span className=\"text-[#F7931A]\">ROVER</span>\n            </h1>\n            <button onClick={onClose}>\n              <X className=\"w-5 h-5 text-gray-500 hover:text-white\" />\n            </button>\n          </div>\n\n          <div className=\"flex items-center gap-3\">\n            {session.user?.profile?.image ? (\n              // eslint-disable-next-line @next/next/no-img-element\n              <img\n                src={session.user.profile.image}\n                className=\"w-12 h-12 rounded-full border border-white/10 object-cover bg-gray-800\"\n                alt=\"Profile\"\n              />\n            ) : (\n              <div className=\"w-12 h-12 rounded-full bg-[#F7931A]/10 border border-[#F7931A]/30 flex items-center justify-center text-[#F7931A]\">\n                <User className=\"w-6 h-6\" />\n              </div>\n            )}\n\n            <div className=\"flex-1 overflow-hidden\">\n              <p className=\"text-base font-bold text-white truncate\">\n                {session.user?.profile?.name || \"Sovereign User\"}\n              </p>\n\n              {/* Npub Copy */}\n              <button\n                onClick={copyNpub}\n                className=\"flex items-center gap-1.5 text-[10px] text-gray-500 hover:text-white transition-colors group mt-1\"\n              >\n                <span className=\"font-mono\">{displayNpub}</span>\n                {copied ? (\n                  <Check className=\"w-3 h-3 text-[#00FF41]\" />\n                ) : (\n                  <Copy className=\"w-3 h-3 opacity-0 group-hover:opacity-100\" />\n                )}\n              </button>\n            </div>\n          </div>\n        </div>\n\n        {/* MENU */}\n        <div className=\"flex-1 py-4 overflow-y-auto\">\n          <div className=\"px-4 mb-2 text-[10px] font-bold text-gray-600 uppercase tracking-widest\">\n            Protocol Layer\n          </div>\n          <nav className=\"space-y-1 px-2\">\n            <MenuItem\n              icon={Radio}\n              label=\"Network Pulse\"\n              onClick={() => {\n                onNavigate(\"activity\");\n                onClose();\n              }}\n            />\n            <MenuItem\n              icon={Trophy}\n              label=\"Proof of Presence\"\n              onClick={() => {\n                onNavigate(\"earn\");\n                onClose();\n              }}\n            />\n          </nav>\n\n          <div className=\"px-4 mt-6 mb-2 text-[10px] font-bold text-gray-600 uppercase tracking-widest\">\n            System\n          </div>\n          <nav className=\"space-y-1 px-2\">\n            <MenuItem\n              icon={Fingerprint}\n              label=\"Manifesto\"\n              onClick={() => {\n                onNavigate(\"manifesto\");\n                onClose();\n              }}\n            />\n          </nav>\n        </div>\n\n        {/* LOGOUT */}\n        <div className=\"p-4 border-t border-white/10 bg-[#121212]\">\n          <button\n            onClick={() => {\n              logout();\n              onClose();\n            }}\n            className=\"flex items-center gap-3 w-full p-2 text-red-500 hover:bg-red-500/10 rounded-lg transition-colors\"\n          >\n            <LogOut className=\"w-4 h-4\" />\n            <span className=\"text-xs font-bold uppercase tracking-widest\">\n              Disconnect Identity\n            </span>\n          </button>\n        </div>\n      </div>\n    </>\n  );\n}\n\nfunction MenuItem({ icon: Icon, label, onClick }: any) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"flex items-center gap-4 w-full p-3 rounded-lg hover:bg-white/5 transition-all group text-left\"\n    >\n      <Icon className=\"w-5 h-5 text-gray-400 group-hover:text-[#F7931A] transition-colors\" />\n      <div className=\"flex-1\">\n        <p className=\"text-sm font-bold text-gray-200 group-hover:text-white\">\n          {label}\n        </p>\n      </div>\n      <ChevronRight className=\"w-4 h-4 text-gray-700 group-hover:text-gray-500\" />\n    </button>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;AACA;AACA;;;;;;;;AAQe,SAAS,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,UAAU,EAAgB;;IAC3E,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,GAAG,IAAA,uKAAU;IACtC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,0UAAQ,EAAC;IAErC,qBAAqB;IACrB,MAAM,OAAO,QAAQ,MAAM,GAAG,uPAAK,CAAC,UAAU,CAAC,QAAQ,MAAM,IAAI;IACjE,MAAM,cAAc,OAAO,GAAG,KAAK,KAAK,CAAC,GAAG,IAAI,GAAG,EAAE,KAAK,KAAK,CAAC,CAAC,IAAI,GAAG;IAExE,MAAM,WAAW;QACf,IAAI,CAAC,MAAM;QACX,UAAU,SAAS,CAAC,SAAS,CAAC;QAC9B,UAAU;QACV,WAAW,IAAM,UAAU,QAAQ;IACrC;IAEA,IAAI,QAAQ,IAAI,KAAK,QAAQ,OAAO,MAAM,wCAAwC;IAElF,qBACE;;0BACE,8VAAC;gBACC,WAAW,IAAA,2IAAE,EACX,mFACA,SACI,oCACA;gBAEN,SAAS;;;;;;0BAGX,8VAAC;gBACC,WAAW,IAAA,2IAAE,EACX,iKACA,SAAS,kBAAkB;;kCAI7B,8VAAC;wBAAI,WAAU;;0CACb,8VAAC;gCAAI,WAAU;;kDACb,8VAAC;wCAAG,WAAU;;4CAAgD;0DACxD,8VAAC;gDAAK,WAAU;0DAAiB;;;;;;;;;;;;kDAEvC,8VAAC;wCAAO,SAAS;kDACf,cAAA,8VAAC,wRAAC;4CAAC,WAAU;;;;;;;;;;;;;;;;;0CAIjB,8VAAC;gCAAI,WAAU;;oCACZ,QAAQ,IAAI,EAAE,SAAS,QACtB,qDAAqD;kDACrD,8VAAC;wCACC,KAAK,QAAQ,IAAI,CAAC,OAAO,CAAC,KAAK;wCAC/B,WAAU;wCACV,KAAI;;;;;6DAGN,8VAAC;wCAAI,WAAU;kDACb,cAAA,8VAAC,iSAAI;4CAAC,WAAU;;;;;;;;;;;kDAIpB,8VAAC;wCAAI,WAAU;;0DACb,8VAAC;gDAAE,WAAU;0DACV,QAAQ,IAAI,EAAE,SAAS,QAAQ;;;;;;0DAIlC,8VAAC;gDACC,SAAS;gDACT,WAAU;;kEAEV,8VAAC;wDAAK,WAAU;kEAAa;;;;;;oDAC5B,uBACC,8VAAC,oSAAK;wDAAC,WAAU;;;;;6EAEjB,8VAAC,iSAAI;wDAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;kCAQ1B,8VAAC;wBAAI,WAAU;;0CACb,8VAAC;gCAAI,WAAU;0CAA0E;;;;;;0CAGzF,8VAAC;gCAAI,WAAU;;kDACb,8VAAC;wCACC,MAAM,oSAAK;wCACX,OAAM;wCACN,SAAS;4CACP,WAAW;4CACX;wCACF;;;;;;kDAEF,8VAAC;wCACC,MAAM,uSAAM;wCACZ,OAAM;wCACN,SAAS;4CACP,WAAW;4CACX;wCACF;;;;;;;;;;;;0CAIJ,8VAAC;gCAAI,WAAU;0CAA+E;;;;;;0CAG9F,8VAAC;gCAAI,WAAU;0CACb,cAAA,8VAAC;oCACC,MAAM,iUAAW;oCACjB,OAAM;oCACN,SAAS;wCACP,WAAW;wCACX;oCACF;;;;;;;;;;;;;;;;;kCAMN,8VAAC;wBAAI,WAAU;kCACb,cAAA,8VAAC;4BACC,SAAS;gCACP;gCACA;4BACF;4BACA,WAAU;;8CAEV,8VAAC,2SAAM;oCAAC,WAAU;;;;;;8CAClB,8VAAC;oCAAK,WAAU;8CAA8C;;;;;;;;;;;;;;;;;;;;;;;;;AAQ1E;GA1IwB;;QACM,uKAAU;;;KADhB;AA4IxB,SAAS,SAAS,EAAE,MAAM,IAAI,EAAE,KAAK,EAAE,OAAO,EAAO;IACnD,qBACE,8VAAC;QACC,SAAS;QACT,WAAU;;0BAEV,8VAAC;gBAAK,WAAU;;;;;;0BAChB,8VAAC;gBAAI,WAAU;0BACb,cAAA,8VAAC;oBAAE,WAAU;8BACV;;;;;;;;;;;0BAGL,8VAAC,6TAAY;gBAAC,WAAU;;;;;;;;;;;;AAG9B;MAfS"}},
    {"offset": {"line": 3947, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/components/ui/FloatingCommandBar.tsx"],"sourcesContent":["import React from \"react\";\nimport {\n  Zap,\n  Command,\n  Map,\n  Trophy,\n  Wallet,\n  X,\n  User,\n  LogIn,\n  Activity,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useSession } from \"@/contexts/NostrSessionContext\";\n\nexport type CommandView =\n  | \"idle\"\n  | \"menu\"\n  | \"wallet\"\n  | \"hub\"\n  | \"earn\"\n  | \"manifesto\"\n  | \"auth\"\n  | \"activity\"\n  | \"sidebar\";\n\ninterface CommandBarProps {\n  balance: number | null;\n  status: \"idle\" | \"connecting\" | \"connected\" | \"error\";\n  view: CommandView;\n  currentHub: string;\n  onSetView: (v: CommandView) => void;\n  onToggleSidebar: () => void;\n}\n\nexport default function FloatingCommandBar({\n  balance,\n  status,\n  view,\n  currentHub,\n  onSetView,\n  onToggleSidebar,\n}: CommandBarProps) {\n  const { session } = useSession();\n\n  const handleCenterClick = () => {\n    if (session.type === \"anon\") {\n      onSetView(\"auth\");\n    } else {\n      onToggleSidebar(); // ‚úÖ OPEN SIDEBAR IF LOGGED IN\n    }\n  };\n\n  return (\n    <div className=\"absolute bottom-8 left-1/2 -translate-x-1/2 z-30 flex flex-col items-center gap-4 w-full max-w-sm px-4\">\n      {/* 1. EXPANDED MENU */}\n      {view === \"menu\" && (\n        <div className=\"flex gap-3 animate-in slide-in-from-bottom-4 fade-in duration-200\">\n          <MenuButton icon={Map} label=\"HUB\" onClick={() => onSetView(\"hub\")} />\n          <MenuButton\n            icon={Activity}\n            label=\"FEED\"\n            onClick={() => onSetView(\"activity\")}\n          />\n          <MenuButton\n            icon={Wallet}\n            label=\"WALLET\"\n            onClick={() => onSetView(\"wallet\")}\n            active={status === \"connected\"}\n          />\n          <MenuButton\n            icon={Trophy}\n            label=\"EARN\"\n            onClick={() => onSetView(\"earn\")}\n          />\n        </div>\n      )}\n\n      {/* 2. MAIN HUD BAR */}\n      <div className=\"flex items-center justify-between w-full max-w-85 h-14 pl-4 pr-2 bg-[#121212]/90 backdrop-blur-xl border border-white/10 rounded-full shadow-2xl shadow-black/50 transition-all\">\n        {/* LEFT: WALLET */}\n        <button\n          onClick={() => onSetView(\"wallet\")}\n          className=\"flex items-center gap-3 w-1/3 hover:opacity-80 transition-opacity text-left\"\n        >\n          <div\n            className={cn(\n              \"p-1.5 rounded-full\",\n              status === \"connected\" ? \"bg-bitcoin/10\" : \"bg-white/5\"\n            )}\n          >\n            <Zap\n              className={cn(\n                \"w-4 h-4\",\n                status === \"connected\"\n                  ? \"text-bitcoin fill-bitcoin\"\n                  : \"text-gray-600\"\n              )}\n            />\n          </div>\n          <div className=\"flex flex-col items-start overflow-hidden\">\n            <span className=\"font-mono text-xs font-bold text-white tracking-tight truncate w-full\">\n              {balance !== null ? balance.toLocaleString() : \"---\"}\n            </span>\n          </div>\n        </button>\n\n        {/* CENTER: IDENTITY / SIDEBAR TRIGGER */}\n        <button\n          onClick={handleCenterClick} // ‚úÖ FIXED HANDLER\n          className=\"flex items-center justify-center w-1/3 h-full border-l border-r border-white/5 px-2 hover:bg-white/5 transition-colors group cursor-pointer\"\n        >\n          {session.type !== \"anon\" ? (\n            // ‚úÖ LOGGED IN: Avatar Only\n            session.user?.profile?.image ? (\n              // eslint-disable-next-line @next/next/no-img-element\n              <img\n                src={session.user.profile.image}\n                className=\"w-8 h-8 rounded-full border border-[#00FF41]/50 shadow-[0_0_10px_rgba(0,255,65,0.2)] object-cover bg-gray-800\"\n                alt=\"Me\"\n              />\n            ) : (\n              <div className=\"w-8 h-8 rounded-full bg-[#00FF41]/10 border border-[#00FF41]/50 flex items-center justify-center text-[#00FF41] shadow-[0_0_10px_rgba(0,255,65,0.2)]\">\n                <User className=\"w-4 h-4\" />\n              </div>\n            )\n          ) : (\n            // LOGGED OUT: Login Text\n            <div className=\"flex items-center gap-2 text-gray-500 group-hover:text-white transition-colors\">\n              <LogIn className=\"w-3 h-3\" />\n              <span className=\"font-mono text-[10px] uppercase tracking-widest\">\n                Login\n              </span>\n            </div>\n          )}\n        </button>\n\n        {/* RIGHT: COMMAND TOGGLE */}\n        <button\n          onClick={() => onSetView(view === \"idle\" ? \"menu\" : \"idle\")}\n          className=\"flex items-center justify-end gap-3 w-1/3 pr-2 group\"\n        >\n          <span className=\"font-mono text-[10px] font-bold text-gray-600 uppercase hidden sm:block\">\n            CMD\n          </span>\n          <div\n            className={cn(\n              \"p-2 rounded-full transition-colors\",\n              view === \"menu\"\n                ? \"bg-white text-black\"\n                : \"bg-white/10 text-white group-hover:bg-white/20\"\n            )}\n          >\n            {view === \"idle\" ? (\n              <Command className=\"w-5 h-5\" />\n            ) : (\n              <X className=\"w-5 h-5\" />\n            )}\n          </div>\n        </button>\n      </div>\n    </div>\n  );\n}\n\n// ... MenuButton component ...\nfunction MenuButton({ icon: Icon, label, onClick, active }: any) {\n  return (\n    <button\n      onClick={onClick}\n      className={cn(\n        \"flex flex-col items-center justify-center w-14 h-14 rounded-2xl border backdrop-blur-md transition-all active:scale-90\",\n        active\n          ? \"bg-bitcoin/10 border-bitcoin text-bitcoin\"\n          : \"bg-[#121212] border-white/10 text-gray-400 hover:border-white/30 hover:text-white\"\n      )}\n    >\n      <Icon className=\"w-5 h-5 mb-1\" />\n      <span className=\"text-[8px] font-bold tracking-widest\">{label}</span>\n    </button>\n  );\n}\n"],"names":[],"mappings":";;;;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;AACA;;;;;;AAsBe,SAAS,mBAAmB,EACzC,OAAO,EACP,MAAM,EACN,IAAI,EACJ,UAAU,EACV,SAAS,EACT,eAAe,EACC;;IAChB,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,uKAAU;IAE9B,MAAM,oBAAoB;QACxB,IAAI,QAAQ,IAAI,KAAK,QAAQ;YAC3B,UAAU;QACZ,OAAO;YACL,mBAAmB,8BAA8B;QACnD;IACF;IAEA,qBACE,8VAAC;QAAI,WAAU;;YAEZ,SAAS,wBACR,8VAAC;gBAAI,WAAU;;kCACb,8VAAC;wBAAW,MAAM,8RAAG;wBAAE,OAAM;wBAAM,SAAS,IAAM,UAAU;;;;;;kCAC5D,8VAAC;wBACC,MAAM,6SAAQ;wBACd,OAAM;wBACN,SAAS,IAAM,UAAU;;;;;;kCAE3B,8VAAC;wBACC,MAAM,uSAAM;wBACZ,OAAM;wBACN,SAAS,IAAM,UAAU;wBACzB,QAAQ,WAAW;;;;;;kCAErB,8VAAC;wBACC,MAAM,uSAAM;wBACZ,OAAM;wBACN,SAAS,IAAM,UAAU;;;;;;;;;;;;0BAM/B,8VAAC;gBAAI,WAAU;;kCAEb,8VAAC;wBACC,SAAS,IAAM,UAAU;wBACzB,WAAU;;0CAEV,8VAAC;gCACC,WAAW,IAAA,2IAAE,EACX,sBACA,WAAW,cAAc,kBAAkB;0CAG7C,cAAA,8VAAC,8RAAG;oCACF,WAAW,IAAA,2IAAE,EACX,WACA,WAAW,cACP,8BACA;;;;;;;;;;;0CAIV,8VAAC;gCAAI,WAAU;0CACb,cAAA,8VAAC;oCAAK,WAAU;8CACb,YAAY,OAAO,QAAQ,cAAc,KAAK;;;;;;;;;;;;;;;;;kCAMrD,8VAAC;wBACC,SAAS;wBACT,WAAU;kCAET,QAAQ,IAAI,KAAK,SAChB,2BAA2B;wBAC3B,QAAQ,IAAI,EAAE,SAAS,QACrB,qDAAqD;sCACrD,8VAAC;4BACC,KAAK,QAAQ,IAAI,CAAC,OAAO,CAAC,KAAK;4BAC/B,WAAU;4BACV,KAAI;;;;;iDAGN,8VAAC;4BAAI,WAAU;sCACb,cAAA,8VAAC,iSAAI;gCAAC,WAAU;;;;;;;;;;mCAIpB,yBAAyB;sCACzB,8VAAC;4BAAI,WAAU;;8CACb,8VAAC,wSAAK;oCAAC,WAAU;;;;;;8CACjB,8VAAC;oCAAK,WAAU;8CAAkD;;;;;;;;;;;;;;;;;kCAQxE,8VAAC;wBACC,SAAS,IAAM,UAAU,SAAS,SAAS,SAAS;wBACpD,WAAU;;0CAEV,8VAAC;gCAAK,WAAU;0CAA0E;;;;;;0CAG1F,8VAAC;gCACC,WAAW,IAAA,2IAAE,EACX,sCACA,SAAS,SACL,wBACA;0CAGL,SAAS,uBACR,8VAAC,0SAAO;oCAAC,WAAU;;;;;yDAEnB,8VAAC,wRAAC;oCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAO3B;GAhIwB;;QAQF,uKAAU;;;KARR;AAkIxB,+BAA+B;AAC/B,SAAS,WAAW,EAAE,MAAM,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,MAAM,EAAO;IAC7D,qBACE,8VAAC;QACC,SAAS;QACT,WAAW,IAAA,2IAAE,EACX,0HACA,SACI,8CACA;;0BAGN,8VAAC;gBAAK,WAAU;;;;;;0BAChB,8VAAC;gBAAK,WAAU;0BAAwC;;;;;;;;;;;;AAG9D;MAfS"}},
    {"offset": {"line": 4221, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/hooks/use-lightning-engine.ts"],"sourcesContent":["import { useState, useEffect } from \"react\";\nimport NDK from \"@nostr-dev-kit/ndk\";\nimport { NDKNWCWallet as NDKNwc } from \"@nostr-dev-kit/wallet\";\n\nexport function useLightningEngine(ndk: NDK | null) {\n  const [nwc, setNwc] = useState<NDKNwc | null>(null);\n  const [balance, setBalance] = useState<number | null>(null);\n  const [status, setStatus] = useState<\n    \"idle\" | \"connecting\" | \"connected\" | \"error\"\n  >(\"idle\");\n\n  // Helper to parse connection string\n  const parseConnectionStr = (str: string) => {\n    try {\n      const url = new URL(str.replace(\"nostr+walletconnect:\", \"http:\"));\n      const pubkey = url.hostname || url.pathname.replace(\"//\", \"\");\n      const relay = url.searchParams.get(\"relay\");\n      const secret = url.searchParams.get(\"secret\");\n      if (!pubkey || !relay || !secret) throw new Error(\"Missing params\");\n      return { pubkey, relayUrls: [relay], secret };\n    } catch (e) {\n      throw new Error(\"Invalid NWC String\");\n    }\n  };\n\n  const ignite = async (connectionString: string) => {\n    if (!ndk) return;\n    setStatus(\"connecting\");\n    try {\n      const config = parseConnectionStr(connectionString);\n      const instance = new NDKNwc(ndk, {\n        pubkey: config.pubkey,\n        relayUrls: config.relayUrls,\n        secret: config.secret,\n      });\n\n      // Wait for handshake\n      await new Promise((r) => setTimeout(r, 1000));\n\n      setNwc(instance);\n      setStatus(\"connected\");\n      localStorage.setItem(\"satsrover_nwc\", connectionString);\n      checkFuel(instance);\n    } catch (e) {\n      console.error(\"Engine Start Failed\", e);\n      setStatus(\"error\");\n    }\n  };\n\n  const checkFuel = async (instance: NDKNwc) => {\n    try {\n      await instance.updateBalance();\n      // @ts-ignore\n      const bal = instance.balance;\n      if (bal && typeof bal.amount === \"number\") setBalance(bal.amount);\n    } catch (e) {\n      console.error(\"Fuel check failed\");\n    }\n  };\n\n  const payInvoice = async (bolt11: string) => {\n    if (!nwc) throw new Error(\"Engine not ready\");\n    const res = await nwc.lnPay({ pr: bolt11 });\n    if (!res) throw new Error(\"No response\");\n    checkFuel(nwc);\n    return res;\n  };\n\n  // Auto-ignite\n  useEffect(() => {\n    const stored = localStorage.getItem(\"satsrover_nwc\");\n    if (stored && ndk && status === \"idle\") ignite(stored);\n  }, [ndk]);\n\n  return {\n    nwc,\n    balance,\n    status,\n    ignite,\n    payInvoice,\n    disconnect: () => {\n      setNwc(null);\n      setBalance(null);\n      setStatus(\"idle\");\n      localStorage.removeItem(\"satsrover_nwc\");\n    },\n  };\n}\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;;AAEO,SAAS,mBAAmB,GAAe;;IAChD,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,0UAAQ,EAAgB;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,0UAAQ,EAAgB;IACtD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,0UAAQ,EAElC;IAEF,oCAAoC;IACpC,MAAM,qBAAqB,CAAC;QAC1B,IAAI;YACF,MAAM,MAAM,IAAI,IAAI,IAAI,OAAO,CAAC,wBAAwB;YACxD,MAAM,SAAS,IAAI,QAAQ,IAAI,IAAI,QAAQ,CAAC,OAAO,CAAC,MAAM;YAC1D,MAAM,QAAQ,IAAI,YAAY,CAAC,GAAG,CAAC;YACnC,MAAM,SAAS,IAAI,YAAY,CAAC,GAAG,CAAC;YACpC,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,QAAQ,MAAM,IAAI,MAAM;YAClD,OAAO;gBAAE;gBAAQ,WAAW;oBAAC;iBAAM;gBAAE;YAAO;QAC9C,EAAE,OAAO,GAAG;YACV,MAAM,IAAI,MAAM;QAClB;IACF;IAEA,MAAM,SAAS,OAAO;QACpB,IAAI,CAAC,KAAK;QACV,UAAU;QACV,IAAI;YACF,MAAM,SAAS,mBAAmB;YAClC,MAAM,WAAW,IAAI,4YAAM,CAAC,KAAK;gBAC/B,QAAQ,OAAO,MAAM;gBACrB,WAAW,OAAO,SAAS;gBAC3B,QAAQ,OAAO,MAAM;YACvB;YAEA,qBAAqB;YACrB,MAAM,IAAI,QAAQ,CAAC,IAAM,WAAW,GAAG;YAEvC,OAAO;YACP,UAAU;YACV,aAAa,OAAO,CAAC,iBAAiB;YACtC,UAAU;QACZ,EAAE,OAAO,GAAG;YACV,QAAQ,KAAK,CAAC,uBAAuB;YACrC,UAAU;QACZ;IACF;IAEA,MAAM,YAAY,OAAO;QACvB,IAAI;YACF,MAAM,SAAS,aAAa;YAC5B,aAAa;YACb,MAAM,MAAM,SAAS,OAAO;YAC5B,IAAI,OAAO,OAAO,IAAI,MAAM,KAAK,UAAU,WAAW,IAAI,MAAM;QAClE,EAAE,OAAO,GAAG;YACV,QAAQ,KAAK,CAAC;QAChB;IACF;IAEA,MAAM,aAAa,OAAO;QACxB,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;QAC1B,MAAM,MAAM,MAAM,IAAI,KAAK,CAAC;YAAE,IAAI;QAAO;QACzC,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;QAC1B,UAAU;QACV,OAAO;IACT;IAEA,cAAc;IACd,IAAA,2UAAS;wCAAC;YACR,MAAM,SAAS,aAAa,OAAO,CAAC;YACpC,IAAI,UAAU,OAAO,WAAW,QAAQ,OAAO;QACjD;uCAAG;QAAC;KAAI;IAER,OAAO;QACL;QACA;QACA;QACA;QACA;QACA,YAAY;YACV,OAAO;YACP,WAAW;YACX,UAAU;YACV,aAAa,UAAU,CAAC;QAC1B;IACF;AACF;GAnFgB"}},
    {"offset": {"line": 4325, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/app/page.tsx"],"sourcesContent":["\"use client\";\nimport { useState, useEffect } from \"react\";\nimport MapView from \"@/components/map/MapView\";\nimport WalletDrawer from \"@/components/wallet/WalletDrawer\";\nimport HubDrawer from \"@/components/hub/HubDrawer\";\nimport EarnDrawer from \"@/components/earn/EarnDrawer\";\nimport ActivityDrawer from \"@/components/earn/ActivityDrawer\";\nimport ManifestoDrawer from \"@/components/ui/ManifestoDrawer\";\nimport AuthDrawer from \"@/components/auth/AuthDrawer\";\nimport Sidebar from \"@/components/layout/Sidebar\";\nimport FloatingCommandBar, {\n  CommandView,\n} from \"@/components/ui/FloatingCommandBar\";\nimport { useSession } from \"@/contexts/NostrSessionContext\"; // ‚úÖ CORRECT IMPORT\nimport { useLightningEngine } from \"@/hooks/use-lightning-engine\";\n\nexport default function Home() {\n  // ‚úÖ USE SESSION CONTEXT (Single Source of Truth)\n  const { ndk, session } = useSession();\n\n  // Pass the NDK instance from context to the wallet engine\n  const { status, balance, ignite, disconnect, payInvoice } =\n    useLightningEngine(ndk);\n\n  const [view, setView] = useState<CommandView>(\"idle\");\n  const [currentHub, setCurrentHub] = useState(\"Global\");\n  const [flyToCoords, setFlyToCoords] = useState<{\n    lat: number;\n    lon: number;\n  } | null>(null);\n  const [isSidebarOpen, setIsSidebarOpen] = useState(false);\n\n  const handleHubSelect = (lat: number, lon: number, name: string) => {\n    setFlyToCoords({ lat, lon });\n    setCurrentHub(name);\n    setView(\"idle\");\n  };\n\n  // ‚úÖ HARD GUARD: If user logs in while AuthDrawer is open, close it immediately\n  useEffect(() => {\n    if (session.type !== \"anon\" && view === \"auth\") {\n      setView(\"idle\");\n    }\n  }, [session.type, view]);\n\n  return (\n    <main className=\"fixed inset-0 flex flex-col bg-[#050505] text-white font-mono overflow-hidden\">\n      {/* 1. MAP LAYER */}\n      <div className=\"absolute inset-0 z-0\">\n        <MapView\n          flyToCoords={flyToCoords}\n          onInteract={() => {\n            setView(\"idle\");\n            setIsSidebarOpen(false);\n          }}\n        />\n      </div>\n\n      {/* 2. HUD LAYER */}\n      <FloatingCommandBar\n        balance={balance}\n        status={status}\n        view={view}\n        currentHub={currentHub}\n        onSetView={setView}\n        onToggleSidebar={() => setIsSidebarOpen(true)}\n      />\n\n      {/* 3. NAVIGATION LAYER */}\n      <Sidebar\n        isOpen={isSidebarOpen}\n        onClose={() => setIsSidebarOpen(false)}\n        onNavigate={(v) => {\n          setView(v as CommandView);\n          setIsSidebarOpen(false);\n        }}\n      />\n\n      {/* 4. INTERACTION LAYERS */}\n\n      <WalletDrawer\n        isOpen={view === \"wallet\"}\n        onClose={() => setView(\"idle\")}\n        status={status}\n        balance={balance}\n        onConnect={ignite}\n        onDisconnect={disconnect}\n        onPay={payInvoice}\n      />\n\n      <HubDrawer\n        isOpen={view === \"hub\"}\n        onClose={() => setView(\"idle\")}\n        onSelect={handleHubSelect}\n      />\n\n      <EarnDrawer isOpen={view === \"earn\"} onClose={() => setView(\"idle\")} />\n\n      <ActivityDrawer\n        isOpen={view === \"activity\"}\n        onClose={() => setView(\"idle\")}\n      />\n\n      <ManifestoDrawer\n        isOpen={view === \"manifesto\"}\n        onClose={() => setView(\"idle\")}\n      />\n\n      {/* ‚úÖ HARD GUARD: AuthDrawer ONLY renders if Anon */}\n      {session.type === \"anon\" && (\n        <AuthDrawer isOpen={view === \"auth\"} onClose={() => setView(\"idle\")} />\n      )}\n    </main>\n  );\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA,8QAA6D,mBAAmB;AAChF;;;AAdA;;;;;;;;;;;;;AAgBe,SAAS;;IACtB,iDAAiD;IACjD,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,GAAG,IAAA,uKAAU;IAEnC,0DAA0D;IAC1D,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,UAAU,EAAE,UAAU,EAAE,GACvD,IAAA,kLAAkB,EAAC;IAErB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,0UAAQ,EAAc;IAC9C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,0UAAQ,EAAC;IAC7C,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,0UAAQ,EAGpC;IACV,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,0UAAQ,EAAC;IAEnD,MAAM,kBAAkB,CAAC,KAAa,KAAa;QACjD,eAAe;YAAE;YAAK;QAAI;QAC1B,cAAc;QACd,QAAQ;IACV;IAEA,+EAA+E;IAC/E,IAAA,2UAAS;0BAAC;YACR,IAAI,QAAQ,IAAI,KAAK,UAAU,SAAS,QAAQ;gBAC9C,QAAQ;YACV;QACF;yBAAG;QAAC,QAAQ,IAAI;QAAE;KAAK;IAEvB,qBACE,8VAAC;QAAK,WAAU;;0BAEd,8VAAC;gBAAI,WAAU;0BACb,cAAA,8VAAC,iKAAO;oBACN,aAAa;oBACb,YAAY;wBACV,QAAQ;wBACR,iBAAiB;oBACnB;;;;;;;;;;;0BAKJ,8VAAC,2KAAkB;gBACjB,SAAS;gBACT,QAAQ;gBACR,MAAM;gBACN,YAAY;gBACZ,WAAW;gBACX,iBAAiB,IAAM,iBAAiB;;;;;;0BAI1C,8VAAC,oKAAO;gBACN,QAAQ;gBACR,SAAS,IAAM,iBAAiB;gBAChC,YAAY,CAAC;oBACX,QAAQ;oBACR,iBAAiB;gBACnB;;;;;;0BAKF,8VAAC,yKAAY;gBACX,QAAQ,SAAS;gBACjB,SAAS,IAAM,QAAQ;gBACvB,QAAQ;gBACR,SAAS;gBACT,WAAW;gBACX,cAAc;gBACd,OAAO;;;;;;0BAGT,8VAAC,mKAAS;gBACR,QAAQ,SAAS;gBACjB,SAAS,IAAM,QAAQ;gBACvB,UAAU;;;;;;0BAGZ,8VAAC,qKAAU;gBAAC,QAAQ,SAAS;gBAAQ,SAAS,IAAM,QAAQ;;;;;;0BAE5D,8VAAC,yKAAc;gBACb,QAAQ,SAAS;gBACjB,SAAS,IAAM,QAAQ;;;;;;0BAGzB,8VAAC,wKAAe;gBACd,QAAQ,SAAS;gBACjB,SAAS,IAAM,QAAQ;;;;;;YAIxB,QAAQ,IAAI,KAAK,wBAChB,8VAAC,qKAAU;gBAAC,QAAQ,SAAS;gBAAQ,SAAS,IAAM,QAAQ;;;;;;;;;;;;AAIpE;GAlGwB;;QAEG,uKAAU;QAIjC,kLAAkB;;;KANE"}}]
}