{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/lib/storage.ts"],"sourcesContent":["// src/lib/storage.ts\n\nconst NSEC_KEY = \"satsrover_nsec\";\n\n/**\n * STOPGAP SECURITY:\n * - sessionStorage clears on tab close (better than localStorage)\n * - still vulnerable to XSS\n * Target: NIP-07 / NIP-46, or WebCrypto encryption if persisting secrets.\n */\nexport function storeNsec(nsec: string) {\n  if (typeof window === \"undefined\") return;\n  sessionStorage.setItem(NSEC_KEY, nsec);\n}\n\nexport function loadNsec(): string | null {\n  if (typeof window === \"undefined\") return null;\n  return sessionStorage.getItem(NSEC_KEY);\n}\n\nexport function clearNsec() {\n  if (typeof window === \"undefined\") return;\n  sessionStorage.removeItem(NSEC_KEY);\n}\n"],"names":[],"mappings":";;;;;;;;AAAA,qBAAqB;AAErB,MAAM,WAAW;AAQV,SAAS,UAAU,IAAY;IACpC;;IACA,eAAe,OAAO,CAAC,UAAU;AACnC;AAEO,SAAS;IACd;;IACA,OAAO,eAAe,OAAO,CAAC;AAChC;AAEO,SAAS;IACd;;IACA,eAAe,UAAU,CAAC;AAC5B"}},
    {"offset": {"line": 36, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/lib/constants.ts"],"sourcesContent":["// src/lib/constants.ts\n\nexport const BITCOIN_HUBS = [\n  {\n    name: \"El Zonte\",\n    country: \"ðŸ‡¸ðŸ‡»\",\n    lat: 13.492,\n    lon: -89.418,\n    desc: \"Bitcoin Beach\",\n  },\n  {\n    name: \"Lugano\",\n    country: \"ðŸ‡¨ðŸ‡­\",\n    lat: 46.0037,\n    lon: 8.9511,\n    desc: \"Plan â‚¿ City\",\n  },\n  {\n    name: \"Prague\",\n    country: \"ðŸ‡¨ðŸ‡¿\",\n    lat: 50.0755,\n    lon: 14.4378,\n    desc: \"Home of Trezor\",\n  },\n  {\n    name: \"Madeira\",\n    country: \"ðŸ‡µðŸ‡¹\",\n    lat: 32.65,\n    lon: -16.908,\n    desc: \"Free Trade Zone\",\n  },\n  {\n    name: \"Berlin\",\n    country: \"ðŸ‡©ðŸ‡ª\",\n    lat: 52.496,\n    lon: 13.437,\n    desc: \"Kreuzberg Area\",\n  },\n  {\n    name: \"Austin\",\n    country: \"ðŸ‡ºðŸ‡¸\",\n    lat: 30.267,\n    lon: -97.743,\n    desc: \"Bitcoin Commons\",\n  },\n  {\n    name: \"Riga\",\n    country: \"ðŸ‡±ðŸ‡»\",\n    lat: 56.949,\n    lon: 24.105,\n    desc: \"Honeybadger HQ\",\n  },\n  {\n    name: \"Prospera\",\n    country: \"ðŸ‡­ðŸ‡³\",\n    lat: 16.326,\n    lon: -86.538,\n    desc: \"RoatÃ¡n Island\",\n  },\n];\n"],"names":[],"mappings":"AAAA,uBAAuB;;;;;AAEhB,MAAM,eAAe;IAC1B;QACE,MAAM;QACN,SAAS;QACT,KAAK;QACL,KAAK,CAAC;QACN,MAAM;IACR;IACA;QACE,MAAM;QACN,SAAS;QACT,KAAK;QACL,KAAK;QACL,MAAM;IACR;IACA;QACE,MAAM;QACN,SAAS;QACT,KAAK;QACL,KAAK;QACL,MAAM;IACR;IACA;QACE,MAAM;QACN,SAAS;QACT,KAAK;QACL,KAAK,CAAC;QACN,MAAM;IACR;IACA;QACE,MAAM;QACN,SAAS;QACT,KAAK;QACL,KAAK;QACL,MAAM;IACR;IACA;QACE,MAAM;QACN,SAAS;QACT,KAAK;QACL,KAAK,CAAC;QACN,MAAM;IACR;IACA;QACE,MAAM;QACN,SAAS;QACT,KAAK;QACL,KAAK;QACL,MAAM;IACR;IACA;QACE,MAAM;QACN,SAAS;QACT,KAAK;QACL,KAAK,CAAC;QACN,MAAM;IACR;CACD"}},
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/lib/geoutils.ts"],"sourcesContent":["import ngeohash from \"ngeohash\";\nimport { BITCOIN_HUBS } from \"./constants\";\n\n// Canonical precisions (DO NOT CHANGE once live)\nexport const GEOHASH_EXACT = 7; // ~150m (User Location)\nexport const GEOHASH_CITY = 3; // ~150km (City Aggregation)\n\nexport function getExactGeohash(lat: number, lon: number): string {\n  return ngeohash.encode(lat, lon, GEOHASH_EXACT);\n}\n\n/**\n * Generates a Deterministic City ID: country-geohashPrefix\n * Example: cz-u2f\n * This ID is stable forever, even if we rename \"Prague\" to \"Praha\".\n */\nexport function generateCityId(\n  lat: number,\n  lon: number\n): { cityId: string; cityName: string; country: string } {\n  // 1. Calculate the math-based ID\n  const prefix = ngeohash.encode(lat, lon, GEOHASH_CITY);\n\n  // 2. Try to resolve human-readable names (UI Layer only)\n  // We check if this geohash is near a known hub to get the correct Country Code\n  let countryCode = \"xx\";\n  let readableName = \"Wilderness\";\n\n  for (const hub of BITCOIN_HUBS) {\n    const dist = getDistanceFromLatLonInKm(lat, lon, hub.lat, hub.lon);\n    if (dist < 100) {\n      // Broad city match\n      countryCode = getCountryCode(hub.country);\n      readableName = hub.name;\n      break;\n    }\n  }\n\n  return {\n    cityId: `${countryCode}-${prefix}`, // e.g. \"cz-u2f\"\n    cityName: readableName,\n    country: countryCode.toUpperCase(),\n  };\n}\n\n// Helper: Haversine Distance\nfunction getDistanceFromLatLonInKm(\n  lat1: number,\n  lon1: number,\n  lat2: number,\n  lon2: number\n) {\n  const R = 6371;\n  const dLat = deg2rad(lat2 - lat1);\n  const dLon = deg2rad(lon2 - lon1);\n  const a =\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(deg2rad(lat1)) *\n      Math.cos(deg2rad(lat2)) *\n      Math.sin(dLon / 2) *\n      Math.sin(dLon / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c;\n}\n\nfunction deg2rad(deg: number) {\n  return deg * (Math.PI / 180);\n}\n\n// Helper: Map Emoji to ISO Code\nfunction getCountryCode(countryStr: string) {\n  const map: Record<string, string> = {\n    \"ðŸ‡¸ðŸ‡»\": \"sv\",\n    \"ðŸ‡¨ðŸ‡­\": \"ch\",\n    \"ðŸ‡¨ðŸ‡¿\": \"cz\",\n    \"ðŸ‡µðŸ‡¹\": \"pt\",\n    \"ðŸ‡©ðŸ‡ª\": \"de\",\n    \"ðŸ‡ºðŸ‡¸\": \"us\",\n    \"ðŸ‡±ðŸ‡»\": \"lv\",\n    \"ðŸ‡­ðŸ‡³\": \"hn\",\n  };\n  return map[countryStr] || \"xx\";\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAGO,MAAM,gBAAgB,GAAG,wBAAwB;AACjD,MAAM,eAAe,GAAG,4BAA4B;AAEpD,SAAS,gBAAgB,GAAW,EAAE,GAAW;IACtD,OAAO,mMAAQ,CAAC,MAAM,CAAC,KAAK,KAAK;AACnC;AAOO,SAAS,eACd,GAAW,EACX,GAAW;IAEX,iCAAiC;IACjC,MAAM,SAAS,mMAAQ,CAAC,MAAM,CAAC,KAAK,KAAK;IAEzC,yDAAyD;IACzD,+EAA+E;IAC/E,IAAI,cAAc;IAClB,IAAI,eAAe;IAEnB,KAAK,MAAM,OAAO,yJAAY,CAAE;QAC9B,MAAM,OAAO,0BAA0B,KAAK,KAAK,IAAI,GAAG,EAAE,IAAI,GAAG;QACjE,IAAI,OAAO,KAAK;YACd,mBAAmB;YACnB,cAAc,eAAe,IAAI,OAAO;YACxC,eAAe,IAAI,IAAI;YACvB;QACF;IACF;IAEA,OAAO;QACL,QAAQ,GAAG,YAAY,CAAC,EAAE,QAAQ;QAClC,UAAU;QACV,SAAS,YAAY,WAAW;IAClC;AACF;AAEA,6BAA6B;AAC7B,SAAS,0BACP,IAAY,EACZ,IAAY,EACZ,IAAY,EACZ,IAAY;IAEZ,MAAM,IAAI;IACV,MAAM,OAAO,QAAQ,OAAO;IAC5B,MAAM,OAAO,QAAQ,OAAO;IAC5B,MAAM,IACJ,KAAK,GAAG,CAAC,OAAO,KAAK,KAAK,GAAG,CAAC,OAAO,KACrC,KAAK,GAAG,CAAC,QAAQ,SACf,KAAK,GAAG,CAAC,QAAQ,SACjB,KAAK,GAAG,CAAC,OAAO,KAChB,KAAK,GAAG,CAAC,OAAO;IACpB,MAAM,IAAI,IAAI,KAAK,KAAK,CAAC,KAAK,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI;IACrD,OAAO,IAAI;AACb;AAEA,SAAS,QAAQ,GAAW;IAC1B,OAAO,MAAM,CAAC,KAAK,EAAE,GAAG,GAAG;AAC7B;AAEA,gCAAgC;AAChC,SAAS,eAAe,UAAkB;IACxC,MAAM,MAA8B;QAClC,QAAQ;QACR,QAAQ;QACR,QAAQ;QACR,QAAQ;QACR,QAAQ;QACR,QAAQ;QACR,QAAQ;QACR,QAAQ;IACV;IACA,OAAO,GAAG,CAAC,WAAW,IAAI;AAC5B"}},
    {"offset": {"line": 180, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/hooks/use-nostr.ts"],"sourcesContent":["import { useState, useEffect } from \"react\";\nimport NDK, {\n  NDKEvent,\n  NDKNip07Signer,\n  NDKPrivateKeySigner,\n  NDKUser,\n} from \"@nostr-dev-kit/ndk\";\nimport { nip19, generateSecretKey } from \"nostr-tools\";\nimport { storeNsec, loadNsec, clearNsec } from \"@/lib/storage\";\nimport { getExactGeohash, generateCityId } from \"@/lib/geoutils\";\n\nlet ndkInstance: NDK | null = null;\n\nexport type SessionType = \"anon\" | \"nip07\" | \"local_nsec\";\n\nexport interface NostrSession {\n  type: SessionType;\n  pubkey?: string;\n  user?: NDKUser;\n}\n\nexport function useNostr() {\n  const [ndk, setNdk] = useState<NDK | null>(null);\n  const [session, setSession] = useState<NostrSession>({ type: \"anon\" });\n\n  // 1. Initialize & Auto-Restore\n  useEffect(() => {\n    const init = async () => {\n      if (!ndkInstance) {\n        ndkInstance = new NDK({\n          explicitRelayUrls: [\n            \"wss://relay.damus.io\",\n            \"wss://relay.primal.net\",\n            \"wss://nos.lol\",\n            \"wss://relay.snort.social\",\n          ],\n        });\n        try {\n          await ndkInstance.connect();\n          setNdk(ndkInstance);\n        } catch (e) {\n          console.error(\"Nostr Init Failed\", e);\n        }\n      } else {\n        setNdk(ndkInstance);\n      }\n    };\n    init();\n  }, []);\n\n  // Restore Session\n  useEffect(() => {\n    if (ndk && session.type === \"anon\") {\n      const storedNsec = loadNsec();\n      if (storedNsec) {\n        loginWithNsec(storedNsec, true).catch(() => clearNsec());\n      }\n    }\n  }, [ndk]);\n\n  // 2. Auth Methods\n  const loginWithExtension = async () => {\n    if (!ndk || !window.nostr) throw new Error(\"No extension\");\n    const signer = new NDKNip07Signer();\n    ndk.signer = signer;\n    const user = await signer.user();\n    await user.fetchProfile();\n    setSession({ type: \"nip07\", pubkey: user.pubkey, user });\n  };\n\n  const loginWithNsec = async (nsec: string, remember: boolean = false) => {\n    if (!ndk) return;\n    try {\n      const { type, data } = nip19.decode(nsec);\n      if (type !== \"nsec\") throw new Error(\"Invalid nsec\");\n\n      const hexKey = Buffer.from(data as Uint8Array).toString(\"hex\");\n      const signer = new NDKPrivateKeySigner(hexKey);\n      ndk.signer = signer;\n      const user = await signer.user();\n      await user.fetchProfile();\n\n      if (remember) storeNsec(nsec);\n      else clearNsec();\n\n      setSession({ type: \"local_nsec\", pubkey: user.pubkey, user });\n    } catch (e) {\n      console.error(\"Login failed\", e);\n      throw e;\n    }\n  };\n\n  const signup = async (remember: boolean = false) => {\n    if (!ndk) return;\n    const sk = generateSecretKey();\n    const hexKey = Buffer.from(sk).toString(\"hex\");\n    const nsec = nip19.nsecEncode(sk);\n    const signer = new NDKPrivateKeySigner(hexKey);\n    ndk.signer = signer;\n    const user = await signer.user();\n\n    if (remember) storeNsec(nsec);\n    else clearNsec();\n\n    setSession({ type: \"local_nsec\", pubkey: user.pubkey, user });\n    return { nsec, user };\n  };\n\n  const updateProfile = async (\n    name: string,\n    about: string,\n    picture: string\n  ) => {\n    if (!ndk || !session.user) return;\n    await session.user.fetchProfile();\n    const existing = session.user.profile || {};\n    session.user.profile = {\n      ...existing,\n      name: name || existing.name,\n      about: about || existing.about,\n      image: picture || existing.image,\n    };\n    await session.user.publish();\n    setSession((prev) => ({ ...prev, user: session.user }));\n  };\n\n  const logout = () => {\n    if (ndk) ndk.signer = undefined;\n    clearNsec();\n    setSession({ type: \"anon\" });\n  };\n\n  // 3. âœ… ARCHITECTURE LOCK: Strict Signal Publishing\n  const publishSignal = async (\n    merchantName: string,\n    merchantId: string, // This maps to the 'place' tag\n    lat: number,\n    lon: number,\n    paymentResult: \"success\" | \"failed\" | \"did_not_try\",\n    paymentMethod: \"lightning\" | \"onchain\" | \"none\",\n    comment: string\n  ) => {\n    if (session.type === \"anon\" || !ndk) throw new Error(\"Auth required\");\n\n    // 1. Calculate Deterministic Data (Geophysics)\n    const geohash = getExactGeohash(lat, lon);\n    const { cityId, cityName, country } = generateCityId(lat, lon);\n\n    const event = new NDKEvent(ndk);\n    event.kind = 1;\n\n    // Human Content (Social Layer - Backward Compatible)\n    const statusEmoji =\n      paymentResult === \"success\"\n        ? \"âœ…\"\n        : paymentResult === \"failed\"\n          ? \"âŒ\"\n          : \"ðŸ‘€\";\n    event.content = `${statusEmoji} ${comment}\\n\\nChecking in at ${merchantName} âš¡ #satsrover`;\n\n    // Machine Tags (Data Layer - The Real Product)\n    event.tags = [\n      // Protocol Namespace\n      [\"L\", \"satsrover\"],\n      [\"l\", \"checkin\", \"satsrover\"],\n      [\"client\", \"satsrover\"],\n\n      // Indexing & Discovery\n      [\"t\", \"satsrover\"],\n      [\"g\", geohash],\n\n      // Context Identity\n      [\"place\", merchantId], // Canonical Place ID (e.g. btcmap:123)\n      [\"city_id\", cityId], // Canonical City ID (e.g. cz-u2f)\n\n      // Metadata (UI Helpers)\n      [\"city\", cityName],\n      [\"country\", country],\n\n      // Economic Signal\n      [\"status\", paymentResult],\n      [\"method\", paymentMethod],\n    ];\n\n    try {\n      // Use .publish() which returns a Set of relays that accepted the event\n      const relays = await event.publish();\n      if (relays.size === 0) {\n        throw new Error(\"No relays accepted the event\");\n      }\n      return true;\n    } catch (e) {\n      console.error(\"Failed to publish\", e);\n      // alert(\"Failed to sign/publish event.\"); // Remove alert, handle in UI\n      return false;\n    }\n  };\n\n  return {\n    ndk,\n    session,\n    loginWithExtension,\n    loginWithNsec,\n    signup,\n    updateProfile,\n    logout,\n    publishSignal,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 420, "column": 0}, "map": {"version":3,"sources":["file:///home/maximoto/dev/sats-rover/apps/web/src/contexts/NostrSessionContext.tsx"],"sourcesContent":["\"use client\";\nimport React, { createContext, useContext } from \"react\";\nimport NDK, { NDKUser } from \"@nostr-dev-kit/ndk\";\nimport { useNostr, NostrSession } from \"@/hooks/use-nostr\";\n\nexport interface SessionCapabilities {\n  canSign: boolean;\n  canPublish: boolean;\n  canPay: boolean;\n}\n\ninterface NostrSessionContextValue {\n  ndk: NDK | null;\n  session: NostrSession;\n  capabilities: SessionCapabilities;\n  loginWithExtension: () => Promise<void>;\n  // âœ… FIXED: Added remember optional param\n  loginWithNsec: (nsec: string, remember?: boolean) => Promise<void>;\n  // âœ… FIXED: Added remember optional param\n  signup: (\n    remember?: boolean\n  ) => Promise<{ nsec: string; user: any } | undefined>;\n  updateProfile: (\n    name: string,\n    about: string,\n    picture: string\n  ) => Promise<void>;\n  logout: () => void;\n  publishSignal: (\n    merchantName: string,\n    merchantId: string,\n    lat: number,\n    lon: number,\n    paymentResult: \"success\" | \"failed\" | \"did_not_try\",\n    paymentMethod: \"lightning\" | \"onchain\" | \"none\",\n    comment: string\n  ) => Promise<boolean>;\n}\n\nconst NostrSessionContext = createContext<NostrSessionContextValue | null>(\n  null\n);\n\nexport function NostrSessionProvider({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const nostr = useNostr();\n\n  const capabilities: SessionCapabilities = {\n    canSign: nostr.session.type !== \"anon\",\n    canPublish: nostr.session.type !== \"anon\",\n    canPay: true,\n  };\n\n  return (\n    <NostrSessionContext.Provider\n      value={{\n        ndk: nostr.ndk,\n        session: nostr.session,\n        capabilities,\n        loginWithExtension: nostr.loginWithExtension,\n        loginWithNsec: nostr.loginWithNsec,\n        signup: nostr.signup,\n        updateProfile: nostr.updateProfile,\n        logout: nostr.logout,\n        publishSignal: nostr.publishSignal,\n      }}\n    >\n      {children}\n    </NostrSessionContext.Provider>\n  );\n}\n\nexport function useSession() {\n  const ctx = useContext(NostrSessionContext);\n  if (!ctx)\n    throw new Error(\"useSession must be used inside NostrSessionProvider\");\n  return ctx;\n}\n"],"names":[],"mappings":";;;;;;;AACA;AAEA;;;AAHA;;;AAuCA,MAAM,oCAAsB,IAAA,+UAAa,EACvC;AAGK,SAAS,qBAAqB,EACnC,QAAQ,EAGT;;IACC,MAAM,QAAQ,IAAA,0JAAQ;IAEtB,MAAM,eAAoC;QACxC,SAAS,MAAM,OAAO,CAAC,IAAI,KAAK;QAChC,YAAY,MAAM,OAAO,CAAC,IAAI,KAAK;QACnC,QAAQ;IACV;IAEA,qBACE,8VAAC,oBAAoB,QAAQ;QAC3B,OAAO;YACL,KAAK,MAAM,GAAG;YACd,SAAS,MAAM,OAAO;YACtB;YACA,oBAAoB,MAAM,kBAAkB;YAC5C,eAAe,MAAM,aAAa;YAClC,QAAQ,MAAM,MAAM;YACpB,eAAe,MAAM,aAAa;YAClC,QAAQ,MAAM,MAAM;YACpB,eAAe,MAAM,aAAa;QACpC;kBAEC;;;;;;AAGP;GA9BgB;;QAKA,0JAAQ;;;KALR;AAgCT,SAAS;;IACd,MAAM,MAAM,IAAA,4UAAU,EAAC;IACvB,IAAI,CAAC,KACH,MAAM,IAAI,MAAM;IAClB,OAAO;AACT;IALgB"}}]
}